{"version":3,"file":"index.js","sources":["../node_modules/babel-plugin-transform-async-to-promises/helpers.js","../src/consts.js","../src/context.js","../src/logger.js","../src/debug.js","../src/util.js","../src/hooks.js","../src/Web3.js","../src/hooks/jotai.js","../src/provider.js","../src/ServerComponent.js","../src/strategies.js"],"sourcesContent":["// A type of promise-like that resolves synchronously and supports only one observer\nexport const _Pact = /*#__PURE__*/(function() {\n\tfunction _Pact() {}\n\t_Pact.prototype.then = function(onFulfilled, onRejected) {\n\t\tconst result = new _Pact();\n\t\tconst state = this.s;\n\t\tif (state) {\n\t\t\tconst callback = state & 1 ? onFulfilled : onRejected;\n\t\t\tif (callback) {\n\t\t\t\ttry {\n\t\t\t\t\t_settle(result, 1, callback(this.v));\n\t\t\t\t} catch (e) {\n\t\t\t\t\t_settle(result, 2, e);\n\t\t\t\t}\n\t\t\t\treturn result;\n\t\t\t} else {\n\t\t\t\treturn this;\n\t\t\t}\n\t\t}\n\t\tthis.o = function(_this) {\n\t\t\ttry {\n\t\t\t\tconst value = _this.v;\n\t\t\t\tif (_this.s & 1) {\n\t\t\t\t\t_settle(result, 1, onFulfilled ? onFulfilled(value) : value);\n\t\t\t\t} else if (onRejected) {\n\t\t\t\t\t_settle(result, 1, onRejected(value));\n\t\t\t\t} else {\n\t\t\t\t\t_settle(result, 2, value);\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\t_settle(result, 2, e);\n\t\t\t}\n\t\t};\n\t\treturn result;\n\t}\n\treturn _Pact;\n})();\n\n// Settles a pact synchronously\nexport function _settle(pact, state, value) {\n\tif (!pact.s) {\n\t\tif (value instanceof _Pact) {\n\t\t\tif (value.s) {\n\t\t\t\tif (state & 1) {\n\t\t\t\t\tstate = value.s;\n\t\t\t\t}\n\t\t\t\tvalue = value.v;\n\t\t\t} else {\n\t\t\t\tvalue.o = _settle.bind(null, pact, state);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\tif (value && value.then) {\n\t\t\tvalue.then(_settle.bind(null, pact, state), _settle.bind(null, pact, 2));\n\t\t\treturn;\n\t\t}\n\t\tpact.s = state;\n\t\tpact.v = value;\n\t\tconst observer = pact.o;\n\t\tif (observer) {\n\t\t\tobserver(pact);\n\t\t}\n\t}\n}\n\nexport function _isSettledPact(thenable) {\n\treturn thenable instanceof _Pact && thenable.s & 1;\n}\n\n// Converts argument to a function that always returns a Promise\nexport function _async(f) {\n\treturn function() {\n\t\tfor (var args = [], i = 0; i < arguments.length; i++) {\n\t\t\targs[i] = arguments[i];\n\t\t}\n\t\ttry {\n\t\t\treturn Promise.resolve(f.apply(this, args));\n\t\t} catch(e) {\n\t\t\treturn Promise.reject(e);\n\t\t}\n\t}\n}\n\n// Awaits on a value that may or may not be a Promise (equivalent to the await keyword in ES2015, with continuations passed explicitly)\nexport function _await(value, then, direct) {\n\tif (direct) {\n\t\treturn then ? then(value) : value;\n\t}\n\tif (!value || !value.then) {\n\t\tvalue = Promise.resolve(value);\n\t}\n\treturn then ? value.then(then) : value;\n}\n\n// Awaits on a value that may or may not be a Promise, then ignores it\nexport function _awaitIgnored(value, direct) {\n\tif (!direct) {\n\t\treturn value && value.then ? value.then(_empty) : Promise.resolve();\n\t}\n}\n\n// Proceeds after a value has resolved, or proceeds immediately if the value is not thenable\nexport function _continue(value, then) {\n\treturn value && value.then ? value.then(then) : then(value);\n}\n\n// Proceeds after a value has resolved, or proceeds immediately if the value is not thenable\nexport function _continueIgnored(value) {\n\tif (value && value.then) {\n\t\treturn value.then(_empty);\n\t}\n}\n\n// Asynchronously iterate through an object that has a length property, passing the index as the first argument to the callback (even as the length property changes)\nexport function _forTo(array, body, check) {\n\tvar i = -1, pact, reject;\n\tfunction _cycle(result) {\n\t\ttry {\n\t\t\twhile (++i < array.length && (!check || !check())) {\n\t\t\t\tresult = body(i);\n\t\t\t\tif (result && result.then) {\n\t\t\t\t\tif (_isSettledPact(result)) {\n\t\t\t\t\t\tresult = result.v;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresult.then(_cycle, reject || (reject = _settle.bind(null, pact = new _Pact(), 2)));\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (pact) {\n\t\t\t\t_settle(pact, 1, result);\n\t\t\t} else {\n\t\t\t\tpact = result;\n\t\t\t}\n\t\t} catch (e) {\n\t\t\t_settle(pact || (pact = new _Pact()), 2, e);\n\t\t}\n\t}\n\t_cycle();\n\treturn pact;\n}\n\n// Asynchronously iterate through an object's properties (including properties inherited from the prototype)\n// Uses a snapshot of the object's properties\nexport function _forIn(target, body, check) {\n\tvar keys = [];\n\tfor (var key in target) {\n\t\tkeys.push(key);\n\t}\n\treturn _forTo(keys, function(i) { return body(keys[i]); }, check);\n}\n\n// Asynchronously iterate through an object's own properties (excluding properties inherited from the prototype)\n// Uses a snapshot of the object's properties\nexport function _forOwn(target, body, check) {\n\tvar keys = [];\n\tfor (var key in target) {\n\t\tif (Object.prototype.hasOwnProperty.call(target, key)) {\n\t\t\tkeys.push(key);\n\t\t}\n\t}\n\treturn _forTo(keys, function(i) { return body(keys[i]); }, check);\n}\n\nexport const _iteratorSymbol = /*#__PURE__*/ typeof Symbol !== \"undefined\" ? (Symbol.iterator || (Symbol.iterator = Symbol(\"Symbol.iterator\"))) : \"@@iterator\";\n\n// Asynchronously iterate through an object's values\n// Uses for...of if the runtime supports it, otherwise iterates until length on a copy\nexport function _forOf(target, body, check) {\n\tif (typeof target[_iteratorSymbol] === \"function\") {\n\t\tvar iterator = target[_iteratorSymbol](), step, pact, reject;\n\t\tfunction _cycle(result) {\n\t\t\ttry {\n\t\t\t\twhile (!(step = iterator.next()).done && (!check || !check())) {\n\t\t\t\t\tresult = body(step.value);\n\t\t\t\t\tif (result && result.then) {\n\t\t\t\t\t\tif (_isSettledPact(result)) {\n\t\t\t\t\t\t\tresult = result.v;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tresult.then(_cycle, reject || (reject = _settle.bind(null, pact = new _Pact(), 2)));\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (pact) {\n\t\t\t\t\t_settle(pact, 1, result);\n\t\t\t\t} else {\n\t\t\t\t\tpact = result;\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\t_settle(pact || (pact = new _Pact()), 2, e);\n\t\t\t}\n\t\t}\n\t\t_cycle();\n\t\tif (iterator.return) {\n\t\t\tvar _fixup = function(value) {\n\t\t\t\ttry {\n\t\t\t\t\tif (!step.done) {\n\t\t\t\t\t\titerator.return();\n\t\t\t\t\t}\n\t\t\t\t} catch(e) {\n\t\t\t\t}\n\t\t\t\treturn value;\n\t\t\t}\n\t\t\tif (pact && pact.then) {\n\t\t\t\treturn pact.then(_fixup, function(e) {\n\t\t\t\t\tthrow _fixup(e);\n\t\t\t\t});\n\t\t\t}\n\t\t\t_fixup();\n\t\t}\n\t\treturn pact;\n\t}\n\t// No support for Symbol.iterator\n\tif (!(\"length\" in target)) {\n\t\tthrow new TypeError(\"Object is not iterable\");\n\t}\n\t// Handle live collections properly\n\tvar values = [];\n\tfor (var i = 0; i < target.length; i++) {\n\t\tvalues.push(target[i]);\n\t}\n\treturn _forTo(values, function(i) { return body(values[i]); }, check);\n}\n\nexport const _asyncIteratorSymbol = /*#__PURE__*/ typeof Symbol !== \"undefined\" ? (Symbol.asyncIterator || (Symbol.asyncIterator = Symbol(\"Symbol.asyncIterator\"))) : \"@@asyncIterator\";\n\n// Asynchronously iterate on a value using it's async iterator if present, or its synchronous iterator if missing\nexport function _forAwaitOf(target, body, check) {\n\tif (typeof target[_asyncIteratorSymbol] === \"function\") {\n\t\tvar pact = new _Pact();\n\t\tvar iterator = target[_asyncIteratorSymbol]();\n\t\titerator.next().then(_resumeAfterNext).then(void 0, _reject);\n\t\treturn pact;\n\t\tfunction _resumeAfterBody(result) {\n\t\t\tif (check && check()) {\n\t\t\t\treturn _settle(pact, 1, iterator.return ? iterator.return().then(function() { return result; }) : result);\n\t\t\t}\n\t\t\titerator.next().then(_resumeAfterNext).then(void 0, _reject);\n\t\t}\n\t\tfunction _resumeAfterNext(step) {\n\t\t\tif (step.done) {\n\t\t\t\t_settle(pact, 1);\n\t\t\t} else {\n\t\t\t\tPromise.resolve(body(step.value)).then(_resumeAfterBody).then(void 0, _reject);\n\t\t\t}\n\t\t}\n\t\tfunction _reject(error) {\n\t\t\t_settle(pact, 2, iterator.return ? iterator.return().then(function() { return error; }) : error);\n\t\t}\n\t}\n\treturn Promise.resolve(_forOf(target, function(value) { return Promise.resolve(value).then(body); }, check));\n}\n\n// Asynchronously implement a generic for loop\nexport function _for(test, update, body) {\n\tvar stage;\n\tfor (;;) {\n\t\tvar shouldContinue = test();\n\t\tif (_isSettledPact(shouldContinue)) {\n\t\t\tshouldContinue = shouldContinue.v;\n\t\t}\n\t\tif (!shouldContinue) {\n\t\t\treturn result;\n\t\t}\n\t\tif (shouldContinue.then) {\n\t\t\tstage = 0;\n\t\t\tbreak;\n\t\t}\n\t\tvar result = body();\n\t\tif (result && result.then) {\n\t\t\tif (_isSettledPact(result)) {\n\t\t\t\tresult = result.s;\n\t\t\t} else {\n\t\t\t\tstage = 1;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif (update) {\n\t\t\tvar updateValue = update();\n\t\t\tif (updateValue && updateValue.then && !_isSettledPact(updateValue)) {\n\t\t\t\tstage = 2;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\tvar pact = new _Pact();\n\tvar reject = _settle.bind(null, pact, 2);\n\t(stage === 0 ? shouldContinue.then(_resumeAfterTest) : stage === 1 ? result.then(_resumeAfterBody) : updateValue.then(_resumeAfterUpdate)).then(void 0, reject);\n\treturn pact;\n\tfunction _resumeAfterBody(value) {\n\t\tresult = value;\n\t\tdo {\n\t\t\tif (update) {\n\t\t\t\tupdateValue = update();\n\t\t\t\tif (updateValue && updateValue.then && !_isSettledPact(updateValue)) {\n\t\t\t\t\tupdateValue.then(_resumeAfterUpdate).then(void 0, reject);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t\tshouldContinue = test();\n\t\t\tif (!shouldContinue || (_isSettledPact(shouldContinue) && !shouldContinue.v)) {\n\t\t\t\t_settle(pact, 1, result);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (shouldContinue.then) {\n\t\t\t\tshouldContinue.then(_resumeAfterTest).then(void 0, reject);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tresult = body();\n\t\t\tif (_isSettledPact(result)) {\n\t\t\t\tresult = result.v;\n\t\t\t}\n\t\t} while (!result || !result.then);\n\t\tresult.then(_resumeAfterBody).then(void 0, reject);\n\t}\n\tfunction _resumeAfterTest(shouldContinue) {\n\t\tif (shouldContinue) {\n\t\t\tresult = body();\n\t\t\tif (result && result.then) {\n\t\t\t\tresult.then(_resumeAfterBody).then(void 0, reject);\n\t\t\t} else {\n\t\t\t\t_resumeAfterBody(result);\n\t\t\t}\n\t\t} else {\n\t\t\t_settle(pact, 1, result);\n\t\t}\n\t}\n\tfunction _resumeAfterUpdate() {\n\t\tif (shouldContinue = test()) {\n\t\t\tif (shouldContinue.then) {\n\t\t\t\tshouldContinue.then(_resumeAfterTest).then(void 0, reject);\n\t\t\t} else {\n\t\t\t\t_resumeAfterTest(shouldContinue);\n\t\t\t}\n\t\t} else {\n\t\t\t_settle(pact, 1, result);\n\t\t}\n\t}\n}\n\n// Asynchronously implement a do ... while loop\nexport function _do(body, test) {\n\tvar awaitBody;\n\tdo {\n\t\tvar result = body();\n\t\tif (result && result.then) {\n\t\t\tif (_isSettledPact(result)) {\n\t\t\t\tresult = result.v;\n\t\t\t} else {\n\t\t\t\tawaitBody = true;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tvar shouldContinue = test();\n\t\tif (_isSettledPact(shouldContinue)) {\n\t\t\tshouldContinue = shouldContinue.v;\n\t\t}\n\t\tif (!shouldContinue) {\n\t\t\treturn result;\n\t\t}\n\t} while (!shouldContinue.then);\n\tconst pact = new _Pact();\n\tconst reject = _settle.bind(null, pact, 2);\n\t(awaitBody ? result.then(_resumeAfterBody) : shouldContinue.then(_resumeAfterTest)).then(void 0, reject);\n\treturn pact;\n\tfunction _resumeAfterBody(value) {\n\t\tresult = value;\n\t\tfor (;;) {\n\t\t\tshouldContinue = test();\n\t\t\tif (_isSettledPact(shouldContinue)) {\n\t\t\t\tshouldContinue = shouldContinue.v;\n\t\t\t}\n\t\t\tif (!shouldContinue) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tif (shouldContinue.then) {\n\t\t\t\tshouldContinue.then(_resumeAfterTest).then(void 0, reject);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tresult = body();\n\t\t\tif (result && result.then) {\n\t\t\t\tif (_isSettledPact(result)) {\n\t\t\t\t\tresult = result.v;\n\t\t\t\t} else {\n\t\t\t\t\tresult.then(_resumeAfterBody).then(void 0, reject);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t_settle(pact, 1, result);\n\t}\n\tfunction _resumeAfterTest(shouldContinue) {\n\t\tif (shouldContinue) {\n\t\t\tdo {\n\t\t\t\tresult = body();\n\t\t\t\tif (result && result.then) {\n\t\t\t\t\tif (_isSettledPact(result)) {\n\t\t\t\t\t\tresult = result.v;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresult.then(_resumeAfterBody).then(void 0, reject);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tshouldContinue = test();\n\t\t\t\tif (_isSettledPact(shouldContinue)) {\n\t\t\t\t\tshouldContinue = shouldContinue.v;\n\t\t\t\t}\n\t\t\t\tif (!shouldContinue) {\n\t\t\t\t\t_settle(pact, 1, result);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t} while (!shouldContinue.then);\n\t\t\tshouldContinue.then(_resumeAfterTest).then(void 0, reject);\n\t\t} else {\n\t\t\t_settle(pact, 1, result);\n\t\t}\n\t}\n}\n\n// Asynchronously implement a switch statement\nexport function _switch(discriminant, cases) {\n\tvar dispatchIndex = -1;\n\tvar awaitBody;\n\touter: {\n\t\tfor (var i = 0; i < cases.length; i++) {\n\t\t\tvar test = cases[i][0];\n\t\t\tif (test) {\n\t\t\t\tvar testValue = test();\n\t\t\t\tif (testValue && testValue.then) {\n\t\t\t\t\tbreak outer;\n\t\t\t\t}\n\t\t\t\tif (testValue === discriminant) {\n\t\t\t\t\tdispatchIndex = i;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Found the default case, set it as the pending dispatch case\n\t\t\t\tdispatchIndex = i;\n\t\t\t}\n\t\t}\n\t\tif (dispatchIndex !== -1) {\n\t\t\tdo {\n\t\t\t\tvar body = cases[dispatchIndex][1];\n\t\t\t\twhile (!body) {\n\t\t\t\t\tdispatchIndex++;\n\t\t\t\t\tbody = cases[dispatchIndex][1];\n\t\t\t\t}\n\t\t\t\tvar result = body();\n\t\t\t\tif (result && result.then) {\n\t\t\t\t\tawaitBody = true;\n\t\t\t\t\tbreak outer;\n\t\t\t\t}\n\t\t\t\tvar fallthroughCheck = cases[dispatchIndex][2];\n\t\t\t\tdispatchIndex++;\n\t\t\t} while (fallthroughCheck && !fallthroughCheck());\n\t\t\treturn result;\n\t\t}\n\t}\n\tconst pact = new _Pact();\n\tconst reject = _settle.bind(null, pact, 2);\n\t(awaitBody ? result.then(_resumeAfterBody) : testValue.then(_resumeAfterTest)).then(void 0, reject);\n\treturn pact;\n\tfunction _resumeAfterTest(value) {\n\t\tfor (;;) {\n\t\t\tif (value === discriminant) {\n\t\t\t\tdispatchIndex = i;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tif (++i === cases.length) {\n\t\t\t\tif (dispatchIndex !== -1) {\n\t\t\t\t\tbreak;\n\t\t\t\t} else {\n\t\t\t\t\t_settle(pact, 1, result);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t\ttest = cases[i][0];\n\t\t\tif (test) {\n\t\t\t\tvalue = test();\n\t\t\t\tif (value && value.then) {\n\t\t\t\t\tvalue.then(_resumeAfterTest).then(void 0, reject);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tdispatchIndex = i;\n\t\t\t}\n\t\t}\n\t\tdo {\n\t\t\tvar body = cases[dispatchIndex][1];\n\t\t\twhile (!body) {\n\t\t\t\tdispatchIndex++;\n\t\t\t\tbody = cases[dispatchIndex][1];\n\t\t\t}\n\t\t\tvar result = body();\n\t\t\tif (result && result.then) {\n\t\t\t\tresult.then(_resumeAfterBody).then(void 0, reject);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar fallthroughCheck = cases[dispatchIndex][2];\n\t\t\tdispatchIndex++;\n\t\t} while (fallthroughCheck && !fallthroughCheck());\n\t\t_settle(pact, 1, result);\n\t}\n\tfunction _resumeAfterBody(result) {\n\t\tfor (;;) {\n\t\t\tvar fallthroughCheck = cases[dispatchIndex][2];\n\t\t\tif (!fallthroughCheck || fallthroughCheck()) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tdispatchIndex++;\n\t\t\tvar body = cases[dispatchIndex][1];\n\t\t\twhile (!body) {\n\t\t\t\tdispatchIndex++;\n\t\t\t\tbody = cases[dispatchIndex][1];\n\t\t\t}\n\t\t\tresult = body();\n\t\t\tif (result && result.then) {\n\t\t\t\tresult.then(_resumeAfterBody).then(void 0, reject);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\t_settle(pact, 1, result);\n\t}\n}\n\n// Asynchronously call a function and pass the result to explicitly passed continuations\nexport function _call(body, then, direct) {\n\tif (direct) {\n\t\treturn then ? then(body()) : body();\n\t}\n\ttry {\n\t\tvar result = Promise.resolve(body());\n\t\treturn then ? result.then(then) : result;\n\t} catch (e) {\n\t\treturn Promise.reject(e);\n\t}\n}\n\n// Asynchronously call a function and swallow the result\nexport function _callIgnored(body, direct) {\n\treturn _call(body, _empty, direct);\n}\n\n// Asynchronously call a function and pass the result to explicitly passed continuations\nexport function _invoke(body, then) {\n\tvar result = body();\n\tif (result && result.then) {\n\t\treturn result.then(then);\n\t}\n\treturn then(result);\n}\n\n// Asynchronously call a function and swallow the result\nexport function _invokeIgnored(body) {\n\tvar result = body();\n\tif (result && result.then) {\n\t\treturn result.then(_empty);\n\t}\n}\n\n// Asynchronously call a function and send errors to recovery continuation\nexport function _catch(body, recover) {\n\ttry {\n\t\tvar result = body();\n\t} catch(e) {\n\t\treturn recover(e);\n\t}\n\tif (result && result.then) {\n\t\treturn result.then(void 0, recover);\n\t}\n\treturn result;\n}\n\n// Asynchronously await a promise and pass the result to a finally continuation\nexport function _finallyRethrows(body, finalizer) {\n\ttry {\n\t\tvar result = body();\n\t} catch (e) {\n\t\treturn finalizer(true, e);\n\t}\n\tif (result && result.then) {\n\t\treturn result.then(finalizer.bind(null, false), finalizer.bind(null, true));\n\t}\n\treturn finalizer(false, result);\n}\n\n// Asynchronously await a promise and invoke a finally continuation that always overrides the result\nexport function _finally(body, finalizer) {\n\ttry {\n\t\tvar result = body();\n\t} catch (e) {\n\t\treturn finalizer();\n\t}\n\tif (result && result.then) {\n\t\treturn result.then(finalizer, finalizer);\n\t}\n\treturn finalizer();\n}\n\n// Rethrow or return a value from a finally continuation\nexport function _rethrow(thrown, value) {\n\tif (thrown)\n\t\tthrow value;\n\treturn value;\n}\n\n// Empty function to implement break and other control flow that ignores asynchronous results\nexport function _empty() {\n}\n\n// Sentinel value for early returns in generators \nexport const _earlyReturn = /*#__PURE__*/ {};\n\n// Asynchronously call a function and send errors to recovery continuation, skipping early returns\nexport function _catchInGenerator(body, recover) {\n\treturn _catch(body, function(e) {\n\t\tif (e === _earlyReturn) {\n\t\t\tthrow e;\n\t\t}\n\t\treturn recover(e);\n\t});\n}\n\n// Asynchronous generator class; accepts the entrypoint of the generator, to which it passes itself when the generator should start\nexport const _AsyncGenerator = /*#__PURE__*/(function() {\n\tfunction _AsyncGenerator(entry) {\n\t\tthis._entry = entry;\n\t\tthis._pact = null;\n\t\tthis._resolve = null;\n\t\tthis._return = null;\n\t\tthis._promise = null;\n\t}\n\n\tfunction _wrapReturnedValue(value) {\n\t\treturn { value: value, done: true };\n\t}\n\tfunction _wrapYieldedValue(value) {\n\t\treturn { value: value, done: false };\n\t}\n\n\t_AsyncGenerator.prototype._yield = function(value) {\n\t\t// Yield the value to the pending next call\n\t\tthis._resolve(value && value.then ? value.then(_wrapYieldedValue) : _wrapYieldedValue(value));\n\t\t// Return a pact for an upcoming next/return/throw call\n\t\treturn this._pact = new _Pact();\n\t};\n\t_AsyncGenerator.prototype.next = function(value) {\n\t\t// Advance the generator, starting it if it has yet to be started\n\t\tconst _this = this;\n\t\treturn _this._promise = new Promise(function (resolve) {\n\t\t\tconst _pact = _this._pact;\n\t\t\tif (_pact === null) {\n\t\t\t\tconst _entry = _this._entry;\n\t\t\t\tif (_entry === null) {\n\t\t\t\t\t// Generator is started, but not awaiting a yield expression\n\t\t\t\t\t// Abandon the next call!\n\t\t\t\t\treturn resolve(_this._promise);\n\t\t\t\t}\n\t\t\t\t// Start the generator\n\t\t\t\t_this._entry = null;\n\t\t\t\t_this._resolve = resolve;\n\t\t\t\tfunction returnValue(value) {\n\t\t\t\t\t_this._resolve(value && value.then ? value.then(_wrapReturnedValue) : _wrapReturnedValue(value));\n\t\t\t\t\t_this._pact = null;\n\t\t\t\t\t_this._resolve = null;\n\t\t\t\t}\n\t\t\t\tvar result = _entry(_this);\n\t\t\t\tif (result && result.then) {\n\t\t\t\t\tresult.then(returnValue, function(error) {\n\t\t\t\t\t\tif (error === _earlyReturn) {\n\t\t\t\t\t\t\treturnValue(_this._return);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconst pact = new _Pact();\n\t\t\t\t\t\t\t_this._resolve(pact);\n\t\t\t\t\t\t\t_this._pact = null;\n\t\t\t\t\t\t\t_this._resolve = null;\n\t\t\t\t\t\t\t_resolve(pact, 2, error);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\treturnValue(result);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Generator is started and a yield expression is pending, settle it\n\t\t\t\t_this._pact = null;\n\t\t\t\t_this._resolve = resolve;\n\t\t\t\t_settle(_pact, 1, value);\n\t\t\t}\n\t\t});\n\t};\n\t_AsyncGenerator.prototype.return = function(value) {\n\t\t// Early return from the generator if started, otherwise abandons the generator\n\t\tconst _this = this;\n\t\treturn _this._promise = new Promise(function (resolve) {\n\t\t\tconst _pact = _this._pact;\n\t\t\tif (_pact === null) {\n\t\t\t\tif (_this._entry === null) {\n\t\t\t\t\t// Generator is started, but not awaiting a yield expression\n\t\t\t\t\t// Abandon the return call!\n\t\t\t\t\treturn resolve(_this._promise);\n\t\t\t\t}\n\t\t\t\t// Generator is not started, abandon it and return the specified value\n\t\t\t\t_this._entry = null;\n\t\t\t\treturn resolve(value && value.then ? value.then(_wrapReturnedValue) : _wrapReturnedValue(value));\n\t\t\t}\n\t\t\t// Settle the yield expression with a rejected \"early return\" value\n\t\t\t_this._return = value;\n\t\t\t_this._resolve = resolve;\n\t\t\t_this._pact = null;\n\t\t\t_settle(_pact, 2, _earlyReturn);\n\t\t});\n\t};\n\t_AsyncGenerator.prototype.throw = function(error) {\n\t\t// Inject an exception into the pending yield expression\n\t\tconst _this = this;\n\t\treturn _this._promise = new Promise(function (resolve, reject) {\n\t\t\tconst _pact = _this._pact;\n\t\t\tif (_pact === null) {\n\t\t\t\tif (_this._entry === null) {\n\t\t\t\t\t// Generator is started, but not awaiting a yield expression\n\t\t\t\t\t// Abandon the throw call!\n\t\t\t\t\treturn resolve(_this._promise);\n\t\t\t\t}\n\t\t\t\t// Generator is not started, abandon it and return a rejected Promise containing the error\n\t\t\t\t_this._entry = null;\n\t\t\t\treturn reject(error);\n\t\t\t}\n\t\t\t// Settle the yield expression with the value as a rejection\n\t\t\t_this._resolve = resolve;\n\t\t\t_this._pact = null;\n\t\t\t_settle(_pact, 2, error);\n\t\t});\n\t};\n\n\t_AsyncGenerator.prototype[_asyncIteratorSymbol] = function() {\n\t\treturn this;\n\t};\n\t\n\treturn _AsyncGenerator;\n})();\n","export const SCOPE_CLIENT = '$client';\r\nexport const SCOPE_GLOBAL = 'global';\r\n\r\nexport const EVENT_DELIM = ':';\r\nexport const EVENT_SET_STATE = 'setState';\r\nexport const EVENT_USE_STATE = 'useState';\r\nexport const EVENT_CREATE_STATE = 'createState';\r\nexport const EVENT_ERROR = 'error';\r\n\r\nexport const EVENT_USE_COMPONENT = 'render';\r\nexport const EVENT_EXECUTE_ACTION = 'executeAction';\r\n\r\nexport const DEFAULT_SCOPE = SCOPE_CLIENT;","import { createContext } from \"react\";\r\n\r\nexport const context = createContext();\r\n","import l0g from 'l0g';\r\n\r\n//Screw this. Because of static class properties I'm forced to transpile my code. \r\n//I don't want to change my source code as it reads way cleaner using static properties\r\n//I need to bundle it for the web any way but using react that should happen automatically\r\n\r\nconst {\r\n    Logger,\r\n    formatters: {Color},\r\n    transports: {ChromeTransport}\r\n} = l0g;\r\n\r\n// static colors = {\r\n//     type: {\r\n//       string: 'lime',\r\n//       number: 'yellow',\r\n//       // object: 'white'\r\n//     },\r\n//     key: {\r\n//       scope: 'blue',\r\n//       ts: 'green',\r\n//       level: {\r\n//         info: 'green',\r\n//         warning: 'orange',\r\n//         error: 'red',\r\n//         debug: 'blue',\r\n//       },\r\n//     },\r\n//     highlight: 'lime.black',\r\n//     default: 'white'\r\n//   };\r\n\r\nColor.colors.type.string = 'green';\r\nColor.colors.type.object = 'green';\r\nColor.colors.key.level.warning = 'red';\r\nColor.colors.key.level.info = 'blue';\r\nconst formatter = new Color((options) => {\r\n    const {ts, level, scope, message} = options;\r\n    return `${ts} ${scope} ${level}: ${message}`\r\n});\r\n\r\nColor.formatMap.get(Color.isArray).unshift((v) => v && `Array[${v.length}]`);\r\nColor.formatMap.get(Color.isObject).unshift((v) => v && `${v.constructor.name}[${Object.keys(v)}]`);\r\n\r\nconst transports = [\r\n    new ChromeTransport({formatter}),\r\n];\r\n\r\nexport const orgLogger = new Logger('debug', {transports}).scope('state-less');\r\nexport const packageLogger = orgLogger.scope('react-client');\r\nconst windowLogger = orgLogger.scope('browser-console');\r\n\r\nif (typeof window !== 'undefined') {\r\n\r\n    window.Logger = Logger;\r\n    window.logger = windowLogger;\r\n}\r\n\r\nexport default packageLogger;","import { useEffect, useRef } from \"react\";\r\nimport logger from './logger'\r\n\r\nconst hookLogger = logger.scope('useTraceUpdate');\r\nexport function useTraceUpdate(props, name) {\r\n    const prev = useRef(props);\r\n    useEffect(() => {\r\n      const changedProps = Object.entries(props).reduce((ps, [k, v]) => {\r\n        if (prev.current[k] !== v) {\r\n          ps[k] = [prev.current[k], v];\r\n        }\r\n        return ps;\r\n      }, {});\r\n      if (Object.keys(changedProps).length > 0) {\r\n        hookLogger.debug`Propery ${name} changed. New props are ${JSON.stringify(props)}`\r\n      } else {\r\n        hookLogger.debug`Propery ${name} didn't change. New props are ${props}`\r\n\r\n      }\r\n      prev.current = props;\r\n    });\r\n  }","import { v4 } from 'uuid';\r\nimport baseLogger from './logger';\r\n\r\nexport const parseSocketResponse = (data) => {\r\n    const { body, statusCode, message } = data;\r\n\r\n    if (statusCode !== 200 && statusCode !== 500) {\r\n        throw new Error(message || 'Internal Server Error');\r\n    }\r\n\r\n    try {\r\n        const parsed = JSON.parse(body);\r\n        return parsed;\r\n    } catch (e) {\r\n        const message = baseLogger.warning`Error parsing render result ${e}`;\r\n        throw new Error(message);\r\n    }\r\n}\r\n\r\nexport const emit = (socket, data) => {\r\n    if (Array.isArray(socket)) {\r\n        socket.forEach((socket) => {\r\n            socket.send(JSON.stringify(data));\r\n        })\r\n    } else {\r\n        socket.send(JSON.stringify(data));\r\n    }\r\n}\r\n\r\nexport const request = async (socket, data) => {\r\n    const id = v4();\r\n    emit(socket, {type: request,  ...data, id});\r\n    return new Promise((resolve, reject) => {\r\n\r\n        const onResponse = async (event) => {\r\n            const data = await consume(event);\r\n            const json = parseSocketResponse(data);\r\n            if (data.id === id) {\r\n                if (data.type === 'error') {\r\n                    reject(json);\r\n                } else {\r\n                    resolve(json);\r\n                }\r\n                off(socket, 'message', onResponse)\r\n            }\r\n        }\r\n        on(socket, 'message', onResponse);\r\n    })\r\n}\r\n\r\nexport const on = (socket, event, fn) => {\r\n    if (Array.isArray(socket)) {\r\n        socket.forEach((socket) => {\r\n            socket.addEventListener(event, fn);\r\n        })\r\n    } else {\r\n        socket.addEventListener(event, fn)\r\n    }\r\n}\r\n\r\nexport const off = (socket, event, fn) => {\r\n    if (Array.isArray(socket)) {\r\n        socket.forEach((socket) => {\r\n            socket.removeEventListener(event, fn);\r\n        })\r\n    } else {\r\n        socket.removeEventListener(event, fn);\r\n    }\r\n}\r\nexport const onMessage = (socket, fn) => on(socket, 'message', fn);\r\n\r\nexport const consume = async (event) => {\r\n    try {\r\n        return JSON.parse(event.data);\r\n    } catch (e) {\r\n        if (typeof event.data === 'string') \r\n            return event.data;\r\n        throw e;\r\n    }\r\n}","import React, { createContext, useEffect, useState, useContext, useMemo } from 'react';\r\nimport { EVENT_ERROR, EVENT_CREATE_STATE, EVENT_DELIM, EVENT_SET_STATE, EVENT_USE_STATE, DEFAULT_SCOPE, EVENT_EXECUTE_ACTION, EVENT_USE_COMPONENT } from './consts';\r\nimport { context } from './context';\r\nimport { atom, useAtom } from 'jotai';\r\nimport baseLogger, { orgLogger } from './logger';\r\nimport { parse, v4 } from 'uuid';\r\nimport { useTraceUpdate } from './debug';\r\nimport packageLogger from './logger';\r\nimport { on, onMessage, emit, consume, off, parseSocketResponse, request } from './util';\r\n\r\nlet stateCount = 0;\r\n \r\nconst increaseCount = () => stateCount++;\r\nconst join = delim => (...strings) => strings.join(delim);\r\nconst genEventName = join(EVENT_DELIM);\r\nconst genIdEventName = event => id => genEventName(event, id);\r\nconst genSetStateEventName = genIdEventName(EVENT_SET_STATE);\r\nconst genCreateStateEventName = genIdEventName(EVENT_CREATE_STATE);\r\nconst genErrorEventName = genIdEventName(EVENT_ERROR);\r\nconst genComponentEvent = genIdEventName(EVENT_USE_COMPONENT);\r\nconst genActionEvent = genIdEventName(EVENT_EXECUTE_ACTION);\r\n\r\n\r\n\r\n/**\r\n * @typedef {'$client' | \"String\"} StateScope - The scope of the state qwe\r\n */\r\n\r\n/**\r\n * @typedef {Object} UseServerStateOptions\r\n * @property {String} key - The key of the state on the server e.g. 'foo'\r\n * @property {StateScope} scope - The scope of the state on the server e.g. bar\r\n * @property {Boolean} strict - Strict mode.\r\n * @property {Serializable} defaultValue - Initial value the server stores and sends back.\r\n */\r\n\r\n/**\r\n * useServerState - Hook to request a state on a public/private state-server.\r\n * @param {*} clientDefaultValue - Initial value the client stores. e.g. \"Loading...\"\r\n * @param {UseServerStateOptions} options - Options\r\n */\r\n\r\nconst alignArgs = (length, ...def) => (...args) => {\r\n    const nargs = [...args];\r\n    for (var i = length; i > def.length; i--) {\r\n        if (!args[i - 1]) {\r\n            nargs[i - 1] = args[i - 2];\r\n            nargs[i - 2] = def[i - 2];\r\n        }\r\n    }\r\n    return nargs;\r\n}\r\n\r\nconst alignUseServerStateArgs = alignArgs(2, null);\r\n\r\nconst atoms = new Map();\r\n\r\nconst useStore = (store, key) => {\r\n    const [atom, setAtom] = useState(null);\r\n};\r\n\r\nexport const useStream = (name, def) => {\r\n    const {socket, open} = useContext(context);\r\n    const id = useMemo(() => v4());\r\n    const [data, setData] = useState(def || null);\r\n\r\n    useEffect(() => {\r\n        if (open) {\r\n            emit(socket, {action: 'stream', name, id});\r\n            on(socket, 'message', async (event) => {\r\n                const data = await consume(event);\r\n                const json = parseSocketResponse(data);\r\n                if (data.id === id) {\r\n                    setData(json);\r\n                }\r\n            })\r\n        }\r\n    },[open]);\r\n\r\n    return data;\r\n}\r\n\r\nconst stateLoadingStates = {};\r\nexport const useServerState = (clientDefaultValue, options) => {\r\n    var [clientDefaultValue, options] = alignUseServerStateArgs(clientDefaultValue, options);\r\n    const {\r\n        key,\r\n        strict = false,\r\n        defaultValue,\r\n        defer = false,\r\n        value = defaultValue,\r\n        scope = DEFAULT_SCOPE,\r\n        suspend = false,\r\n        rendered = null,\r\n        requestType = 'request',\r\n        ...rest\r\n    } = options\r\n    const ctx = useContext(context);\r\n    try {\r\n        const { socket, open, payload } = ctx;\r\n        const debugProps = useMemo(() => ({ clientDefaultValue, options }))\r\n        const defaultState = useMemo(() => ({ value: clientDefaultValue, id: rest.id || null, scope, key }));\r\n        let atm;\r\n\r\n        if (!atoms.has(`${scope}:${key}`)) {\r\n            atm = atom({ defaultState, clientId: increaseCount() })\r\n            stateLoadingStates[`${scope}:${key}`] = false;\r\n            atoms.set(`${scope}:${key}`, atm);\r\n        } else {\r\n            atm = atoms.get(`${scope}:${key}`)\r\n        }\r\n\r\n        const removeAllListeners = useMemo(() => false && socket.removeAllListeners.bind(socket), [socket]);\r\n\r\n        const [state, setState] = useAtom(atm);\r\n\r\n        \r\n        useEffect(() => {\r\n            if (rest.id) {\r\n                setState({...state, id: rest.id})\r\n            }\r\n        }, [rest.id]);\r\n\r\n        const { clientId } = state;\r\n\r\n        const setLoading = (loading) => {\r\n            stateLoadingStates[`${scope}:${key}`] = loading;\r\n        }\r\n\r\n        const extendState = data => setState({ ...state, ...data });\r\n\r\n        const { id, error } = state;\r\n        const setStateEvent = useMemo(() => genSetStateEventName(id), [id]);\r\n        const createStateEvent = useMemo(() => genCreateStateEventName(clientId), [clientId]);\r\n        const errorEvent = useMemo(() => genErrorEventName(clientId), [clientId]);\r\n\r\n        const onTimeout = () => {\r\n            setState((state) => {\r\n                const id = state.id;\r\n                if (!id) {\r\n                    return {\r\n                        ...state,\r\n                        error: new Error('Cancelling state due to timeout')\r\n                    }\r\n                }\r\n                return state;\r\n            })\r\n\r\n            setLoading(false);\r\n        }\r\n\r\n        useEffect(() => {\r\n            let to;\r\n            if (open && !id && !error && !loading && !defer && !stateLoadingStates[`${scope}:${key}`]) {\r\n                \r\n                stateLoadingStates[`${scope}:${key}`] = true;\r\n                var onSetValue = async (event) => {\r\n                    const eventData = await consume(event);\r\n                    const data = parseSocketResponse(eventData);\r\n                    if (eventData.action === 'setValue' && (clientId === eventData.requestId || id === data.id) && typeof data.value === 'undefined') {\r\n                        return state;\r\n                    }\r\n                    if (eventData.action === 'setValue' && (clientId === eventData.requestId || id === data.id)) {\r\n                        stateLoadingStates[`${scope}:${key}`] = false;\r\n                        setState((state) => {\r\n                            return { ...state, ...data }\r\n                        });\r\n                    }\r\n                };\r\n                onMessage(socket, onSetValue);\r\n                // on(socket, 'message',async (event) => {\r\n                //     const data = await consume(event);\r\n                //     if (data.type === 'error' && id === data.id) {\r\n                //         const err = await parseSocketResponse(data);\r\n\r\n                //         debugger;\r\n                //         console.log (\"SETTING useState Error\",id, data.id, err);\r\n                //         extendState({error: new Error(err.message)});\r\n                //     }\r\n                // });\r\n                emit(socket, { action: EVENT_USE_STATE, key, value, scope, requestId: clientId, options: { ...rest }, requestType });\r\n                setLoading(to);\r\n            }\r\n\r\n            clearTimeout(loading);\r\n            return () => {\r\n                off(socket, 'message', onSetValue);\r\n                // [createStateEvent].forEach(event => socket.removeAllListeners(event));\r\n            }\r\n        }, [open, defer])\r\n\r\n        useEffect(() => {\r\n            if (id) {\r\n                if (!defer && id) {\r\n                    var onSetValue = async () => {\r\n                        const eventData = await consume(event);\r\n                        const data = parseSocketResponse(eventData);\r\n                        if (eventData.action === 'setValue' && (clientId === eventData.requestId || id === data.id) && typeof data.value !== 'undefined') {\r\n                            return state;\r\n                        }\r\n                        if (eventData.action === 'setValue' && (clientId === eventData.requestId || id === data.id)) {\r\n                            setState((state) => {\r\n                                delete state.error;\r\n                                return { ...state, ...data }\r\n                            });\r\n                        }\r\n                    }\r\n                    on(socket, 'message', onSetValue)\r\n\r\n                    var onError = async (event) => {\r\n                        const data = await consume(event);\r\n                        /**\r\n                         * Only handles error messages that have the same id as the state. \r\n                         * There's currently no serverside mechanism that raises a state specific error. \r\n                         * This needs to be updated on the serverside to reflect the changes \r\n                         */\r\n                        if (data.type === 'error' && id === data.id) {\r\n                            const err = await parseSocketResponse(data);\r\n                            extendState({error: new Error(err.message)});\r\n                        }\r\n                    }\r\n\r\n                    on(socket, 'message', onError);\r\n                }\r\n            }\r\n            return () => {\r\n                if (id) {\r\n                    off(socket, 'message', onSetValue)\r\n                    off(socket, 'message', onError)\r\n                }\r\n            }\r\n        });\r\n\r\n        useEffect(() => {\r\n            if (strict && error) {\r\n                throw error;\r\n            }\r\n        }, [error]);\r\n\r\n        useEffect(() => {\r\n            // if (id || error) {\r\n            setLoading(false);\r\n            // }\r\n        }, [id, error, key]);\r\n\r\n        const setServerState = (value) => {\r\n            socket.emit(EVENT_SET_STATE, {\r\n                id,\r\n                key,\r\n                value,\r\n            }, {\r\n                scope\r\n            })\r\n        }\r\n\r\n        console.log (\"USE SERVER STATE\", key, state.error)\r\n        if (state.error) {\r\n            if (strict) {\r\n                throw new Error(state.error);\r\n            }\r\n            return [state.error, state.value];\r\n        }\r\n\r\n        if (suspend && !state.value && loading && !id) {\r\n            // return [state.value, createStateEvent];\r\n            throw new Promise(Function.prototype)\r\n\r\n        }\r\n\r\n        if (!key && options.defer) {\r\n            return [clientDefaultValue || null];\r\n        }\r\n\r\n        // baseLogger.debug`Returning live state ${state} ${key} with value ${state.value} ${clientDefaultValue}`\r\n        return [state.value || clientDefaultValue, setServerState];\r\n    } catch (e) {\r\n        if (!ctx) throw new Error('No available context. Are you missing a Provider?');\r\n        throw e;\r\n    }\r\n}\r\n\r\n\r\nexport const useResponse = (fn, action, keepAlive) => {\r\n    const ctx = useContext(context);\r\n\r\n    const { socket } = ctx;\r\n\r\n    const [id, setId] = useState(null);\r\n\r\n    useEffect(() => {\r\n        if (!id) return;\r\n        onMessage(socket, async (event) => {\r\n            const eventData = await consume(event);\r\n            const data = parseSocketResponse(eventData);\r\n            if (eventData.id === id) {\r\n                fn(data);\r\n            }\r\n        })\r\n    }, [id]);\r\n\r\n    return (...args) => {\r\n        const id = action(...args);\r\n        setId(id);\r\n    };\r\n}\r\nconst componentAtoms = new Map();\r\nconst loadingStates = {};\r\n\r\n\r\n/**\r\n * useComponent - Hook that renders serverside components\r\n * @param {*} componentKey - The key of the serverside component \r\n * @param {*} options - Options\r\n * @param {boolean} options.strict - Throws errors in strict mode \r\n * @param {boolean} options.suspend - Throws a promise while loading\r\n * @param {string} options.scope - The scope of the components store\r\n */\r\nexport const useComponent = (componentKey, options = {}, rendered) => {\r\n    const {\r\n        strict = false,\r\n        suspend = true,\r\n        scope = DEFAULT_SCOPE,\r\n        props: clientProps,\r\n        ...rest\r\n    } = options\r\n\r\n    const ctx = useContext(context);\r\n    const logAtom = useMemo(() => atom(), [componentKey]);\r\n    try {\r\n        const { socket, sockets, open, secOpen, allOpen, headers } = ctx;\r\n        const debugProps = useMemo(() => ({ key: componentKey, options }))\r\n        const defaultState = useMemo(() => ({ component: rendered, props: {}, scope, key: componentKey }));\r\n\r\n        let atm;\r\n\r\n        if (!componentAtoms.has(`${scope}:${componentKey}`)) {\r\n            atm = atom({ defaultState });\r\n            loadingStates[`${scope}:${componentKey}`] = false;\r\n            componentAtoms.set(`${scope}:${componentKey}`, atm);\r\n        } else {\r\n            atm = componentAtoms.get(`${scope}:${componentKey}`)\r\n        }\r\n\r\n        const removeAllListeners = useMemo(() => false && socket.removeAllListeners.bind(socket), [socket]);\r\n\r\n        const [internalState, setState] = useAtom(atm);\r\n        \r\n        const extendState = data => setState({ ...internalState, ...data });\r\n        const setLoading = loading => extendState({loading});\r\n\r\n        const {\r\n            component,\r\n            loading\r\n        } = internalState;\r\n\r\n        const [componentState] = useServerState(component, {\r\n            key: componentKey,\r\n            scope: 'public',\r\n            defer: !component && !rendered,\r\n            requestType: 'subscribe',\r\n            rendered,\r\n        });\r\n        // useTraceUpdate(internalState);\r\n\r\n        const resolved = {};\r\n        const keys = Object.keys((componentState || rendered)?.props || {});\r\n        keys.length = 15;\r\n\r\n\r\n        for (const propKey of keys) {\r\n            const serverProps = (componentState||rendered)?.props || {};\r\n            const state = serverProps[propKey] || {};\r\n\r\n            const resolvedState = useServerState(state.value, {\r\n                key: state.key,\r\n                scope: state.scope,\r\n                id: state.id,\r\n                defer: !state.id || !state.key || !state.scope\r\n            });\r\n            if (state.id && state.key && state.scope) {\r\n                if (typeof resolvedState[0] !== 'undefined') {\r\n                    const [value, setValue] = resolvedState;\r\n                    const setKey = `set${propKey[0].toUpperCase()}${propKey.slice(1)}`\r\n                    resolved[propKey] = value;\r\n                    resolved[setKey] = setValue;\r\n                }\r\n            }\r\n        }\r\n        /**Bind action functions */\r\n        (componentState||rendered)?.props?.children?.filter((child) => {\r\n            return child.component === 'Action';\r\n        }).forEach((action) => {\r\n            action.props.fns = action.props.handler.reduce((fns, handler) => {\r\n                return Object.assign(fns, {\r\n                    [handler]: async (...args) => {\r\n                        const id = v4();\r\n                        try {\r\n                            const res = await request([socket, ...sockets], { action: 'call', id, componentKey, name: action.props.name, handler, args, headers });\r\n                            return res;\r\n                        } catch (err) {\r\n                            throw err;\r\n                            const errObj = new Error(err.message);\r\n                            Object.assign(errObj, err);\r\n                            console.log(\"Parsed Error\", err, state, componentState, resolved);\r\n                            extendState({error: errObj});\r\n\r\n                        }\r\n                    }\r\n                });\r\n            }, {});\r\n\r\n        })\r\n\r\n        const { props, error } = component || {};\r\n        const cs = useMemo(() => ({rendered}))\r\n\r\n        const onTimeout = () => {\r\n            loadingStates[`${scope}:${componentKey}`] = false;\r\n        }\r\n\r\n        useEffect(() => {\r\n            let to;\r\n            if (open && !props && !error && !loading && !loadingStates[`${scope}:${componentKey}`]) {\r\n                to = setTimeout(onTimeout, 15000)\r\n                loadingStates[`${scope}:${componentKey}`] = true;\r\n                onMessage(socket, async (event) => {\r\n                    try {\r\n\r\n                        const eventData = await consume(event);\r\n                        /**TODO: fix base scope === 'public' */\r\n                        if (eventData.action === 'render' && eventData.key == componentKey) {\r\n                            const data = parseSocketResponse(eventData);\r\n                            const {error, ...rest} = internalState;\r\n                            setState({ ...rest, component: data });\r\n                        }\r\n                    } catch (e) {\r\n                    }\r\n                });\r\n\r\n                /* I'm not sure if this is the proper place to handle errors from a component. There's no serverside mechanism that sends error messages from components */\r\n                onMessage(socket, async (event) => {\r\n                    const data = await consume(event);\r\n                    if (data.type === 'error' && data.key == componentKey) {\r\n                        const err = await parseSocketResponse(data);\r\n                        const errObj = new Error(err.message);\r\n                        Object.assign(errObj, err);\r\n                        console.log(\"Parsed Error\", err);\r\n                        extendState({error: errObj});\r\n                    }\r\n                });\r\n\r\n                on(socket, 'log', (data) => {\r\n                    data.tag[0].raw = 'Fake Tagged Template String Arg';\r\n                    orgLogger.scope(data.scope).setMessageLevel(data.level).log(...data.tag)\r\n                });\r\n\r\n                console.log (\"Emit render\")\r\n                emit(socket, { action: EVENT_USE_COMPONENT, key: componentKey, scope: scope || 'base', props: clientProps, options: { ...rest }, headers});\r\n\r\n                setLoading(to);\r\n            }\r\n\r\n            secOpen.forEach((open, i) => {\r\n                if (open) {\r\n                    const socket = sockets[i];\r\n                    console.log (\"Emit render 2\")\r\n\r\n                    emit(socket, { action: EVENT_USE_COMPONENT, key: componentKey, scope: scope || 'base', options: { ...rest } });\r\n                }\r\n            })\r\n\r\n            clearTimeout(loading);\r\n\r\n            () => {\r\n                [EVENT_ERROR].forEach(event => socket.removeAllListeners(event));\r\n            }\r\n        }, [open])\r\n\r\n        useEffect(() => {\r\n            if (strict && error) {\r\n                throw new Error(error);\r\n            }\r\n        }, [error]);\r\n\r\n        useEffect(() => {\r\n            setLoading(false);\r\n        }, [internalState.props, error]);\r\n\r\n        if (internalState.error && !component && !rendered) {\r\n            return internalState\r\n        }\r\n\r\n        if (componentState instanceof Error) {\r\n            throw componentState;\r\n        }\r\n        if (!component && loading) {\r\n            return defaultState;\r\n            throw new Promise(Function.prototype)\r\n        }\r\n\r\n        return { ...(rendered || {}), ...componentState, ...internalState, resolved };\r\n    } catch (e) {\r\n        if (!ctx) throw new Error('No available context. Are you missing a Provider?');\r\n        throw e;\r\n    }\r\n}\r\n\r\n\r\nexport const useServerAtom = (atm, clientDefaultValue, options) => {\r\n    const { useAtom } = useContext(context);\r\n\r\n    const [state, setState] = useServerState(clientDefaultValue, options);\r\n    const [value, setAtomValue] = useAtom(atm);\r\n\r\n    useEffect(() => {\r\n        setAtomValue(state);\r\n    }, [state]);\r\n\r\n    return [value, setAtomValue];\r\n}\r\n\r\nconst Test = () => {\r\n    useServerState('test', {\r\n        strict\r\n    })\r\n}\r\n\r\n","import React from 'react';\r\nimport { Web3ReactProvider } from '@web3-react/core';\r\nimport { Web3Provider as ETHWeb3Provider } from \"@ethersproject/providers\";\r\nimport { createContext, useEffect, useState } from 'react';\r\nimport { InjectedConnector } from '@web3-react/injected-connector'\r\nimport { useWeb3React } from '@web3-react/core'\r\nimport Web3 from 'web3'\r\n\r\nexport const injected = new InjectedConnector({ supportedChainIds: [56, 1337] })\r\n\r\nfunction getLibrary(provider, connector) {\r\n  return new ETHWeb3Provider(provider) // this will vary according to whether you use e.g. ethers or web3.js\r\n}\r\n\r\nexport const web3Context = createContext();\r\n\r\nexport const Web3UtilProvider = ({children, autoActivate = true}) => {\r\n  const web3React = useWeb3React();\r\n  const { activate, account, active, error, ...rest } = web3React;\r\n  const [web3, setWeb3] = useState(null);\r\n\r\n\r\n  const activateInjected = async () => activate(injected)\r\n\r\n  useEffect(() => {\r\n    if (!autoActivate) return;\r\n    (async () => {\r\n      await activate(injected);\r\n    })()\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (account) {\r\n      const _web3 = new Web3(web3React?.library?.provider)\r\n      setWeb3(_web3);\r\n    }\r\n  }, [account])\r\n  /**\r\n   * \r\n   * @param {*} web3 - The web3 instance\r\n   * @param {*} message - The message to sign\r\n   * @param {*} account - The account to sign with\r\n   * @returns - The signature\r\n   */\r\n  async function sign (message, account) {\r\n    if (!web3 && !account) throw new Error('Web 3 not yet loaded, please connect an account')\r\n    let res;\r\n    if (account) {\r\n      const web3 = new Web3(web3React?.library?.provider)\r\n      res = await web3.eth.personal.sign(message, account);\r\n    } else {\r\n      res = await web3.eth.personal.sign(message, account);\r\n    }\r\n    return res;\r\n  }\r\n\r\n  /**\r\n   * Recovers the account from a signed message\r\n   * @param {*} web3 \r\n   * @param {*} message \r\n   * @param {*} sig \r\n   */\r\n  async function recover (message, sig) {\r\n    if (!web3) throw new Error('Web 3 not yet loaded, please connect an account')\r\n    const res = await web3.eth.personal.ecRecover(message, sig);\r\n    return res;\r\n  }\r\n\r\n  /**\r\n   * Verifies an account by signing a message.\r\n   * @param *{} web3 \r\n   * @param {*} account  The account to verify\r\n   * @param {*} message  - Optional message to sign.\r\n   * @returns \r\n   */\r\n  async function verify (account, message = 'Please verify your Identity by signing this message.') {\r\n    console.log (\"VERIFY \", account, message)\r\n    if (!web3) throw new Error('Web 3 not yet loaded, please connect an account')\r\n    const sig = await sign(message, account);\r\n    const acc = await recover(message, sig);\r\n    console.log (\"VERIFIED\", account, acc, sig)\r\n    return acc.toLowerCase() === account.toLowerCase();\r\n  }\r\n\r\n  return <web3Context.Provider value={{activateInjected, sign, recover, verify, active, account, error, ...rest}}>\r\n    {children}\r\n  </web3Context.Provider>\r\n}\r\nexport const Web3Provider = ({children, ...rest}) => {\r\n  return <Web3ReactProvider getLibrary={getLibrary}>\r\n    <Web3UtilProvider {...rest}>\r\n      {children}\r\n    </Web3UtilProvider>\r\n  </Web3ReactProvider>\r\n}","import { useAtom } from \"jotai\";\nimport { useEffect } from \"react\";\n\nconst map = {};\n\nexport const useLocalStorage = (name, atom, defaultValue) => {\n  const [value, setValue] = useAtom(atom);\n  useEffect(() => {\n    const storedValue = localStorage[name];\n\n    try {\n      let parsedValue;\n      try {\n        parsedValue = storedValue ? JSON.parse(storedValue) : defaultValue;\n      } catch (e) {\n        parsedValue = null;\n      }\n      if (!map[name]) {\n        map[name] = true;\n        // parsedValue.__initialized = true;\n        setValue(parsedValue);\n      }\n    } catch (e) {\n      throw new Error(e);\n    }\n\n    return () => {\n      map[name] = false;\n    };\n  }, []);\n\n  const setPersistentValue = (val) => {\n    const string = JSON.stringify(val);\n    localStorage[name] = string;\n    setValue(val);\n  };\n\n  return [value, setPersistentValue, setValue];\n};\n","import React, { useContext, useEffect, useMemo, useState } from 'react';\r\nimport { context } from './context';\r\n// import ws from 'ws';\r\nimport { on, emit, consume, request } from './util';\r\n\r\nimport { atom, Provider as JotaiProvider } from 'jotai';\r\nimport { packageLogger } from './logger';\r\nimport { Web3Provider, web3Context } from './Web3';\r\nimport { useLocalStorage } from './hooks/jotai';\r\n// import { web3Context, Web3UtilProvider } from '../../algo-trade-frontend/src/provider/Web3';\r\n\r\nexport const useClientContext = () => {\r\n    const internalCtx = useContext(context);\r\n    const web3Ctx = useContext(web3Context);\r\n    return { ...internalCtx, ...web3Ctx }\r\n}\r\n\r\nlet compId;\r\nexport const useAuth = (useStrategy, auto) => {\r\n    const { open, socket, headers, setHeaders } = useContext(context);\r\n    const { authenticate: auth, logout: deauth, id } = useStrategy();\r\n    const [authed, setHasAuthed] = useState(false);\r\n    useEffect(() => {\r\n        (async () => {\r\n            if (open && !authed) {\r\n                const challenge = await request(socket, { action: 'auth', phase: 'challenge', headers});\r\n                if (challenge.address) {\r\n                    setHasAuthed(true);\r\n                } else {\r\n                    const newHeaders = {...headers};\r\n                    delete newHeaders.Authorization;\r\n                    \r\n                    debugger;\r\n                    setHeaders(newHeaders);\r\n                }\r\n                console.log (\"AUTO LOGIN\", challenge);\r\n            }\r\n        })()\r\n    }, [open, authed]);\r\n\r\n    async function authenticate(...args) {\r\n        const challenge = await request(socket, { action: 'auth', phase: 'challenge' });\r\n        const data = await auth(challenge, ...args);\r\n        if (data.success)\r\n            try {\r\n                const response = await request(socket, {\r\n                    action: 'auth',\r\n                    phase: 'response',\r\n                    ...data\r\n                });\r\n                console.log(\"AUTH RESPONSE\", response)\r\n                setHeaders({\r\n                    ...headers,\r\n                    Authorization: `Bearer ${response}`\r\n                });\r\n                setHasAuthed(true);\r\n                return response;\r\n            } catch (e) {\r\n                throw e;\r\n            }\r\n    }\r\n\r\n    function logout() {\r\n        const { Authorization, ...rest } = headers;\r\n        debugger;\r\n        deauth();\r\n        setHeaders(rest);\r\n    }\r\n\r\n    useEffect(() => {\r\n        (async () => {\r\n            if (id && compId && (compId !== id) && authed) {\r\n                compId = id;\r\n                await logout();\r\n            }\r\n        })()\r\n        // return () => {\r\n        //     compId = null;\r\n        // }\r\n    }, [id])\r\n\r\n    return { authenticate, logout };\r\n}\r\n\r\nconst headerAtom = atom();\r\nconst _Provider = (props) => {\r\n    const { urls = [], url, headers: staticHeaders = {}, useAtom } = props;\r\n    const [open, setOpen] = useState(false);\r\n    const [headers, setHeaders] = useLocalStorage('headers', headerAtom, staticHeaders)\r\n    const [secOpen, setSecOpen] = useState(urls.map(() => false));\r\n    const [error, setError] = useState(null);\r\n\r\n    const allOpen = secOpen.reduce((all, cur) => all && cur, open);\r\n    if (!url)\r\n        throw new Error(\"Missing property 'url' in Provider props.\");\r\n\r\n    // const socket = useMemo(() => {\r\n    //     return io(url);\r\n    // }, [url]);\r\n\r\n    const socket = useMemo(() => {\r\n        if (typeof window === 'undefined' || typeof WebSocket === 'undefined') return;\r\n\r\n\r\n        const ws = new WebSocket(url);\r\n        ws.addEventListener('open', function open() {\r\n            console.log(\"connected\")\r\n            // ws.send(JSON.stringify({\"action\" : \"render\" , \"message\" : \"Hello everyone\"}));\r\n            // ws.send(JSON.stringify({\"action\" : \"useState\" ,\"key\":\"votes\", \"scope\":\"base\"}));\r\n            // console.log (\"sent\")\r\n            setOpen(true);\r\n        });\r\n        ws.addEventListener('message', async (event) => {\r\n            const data = await consume(event);\r\n        });\r\n\r\n        return ws;\r\n    }, [url, typeof window]);\r\n\r\n    const sockets = useMemo(() => {\r\n        return urls.map((url, i) => {\r\n            if (typeof window === 'undefined' || typeof WebSocket === 'undefined') return;\r\n            const ws = new WebSocket(url);\r\n            ws.addEventListener('open', function open() {\r\n                console.log(\"connected\")\r\n                // ws.send(JSON.stringify({\"action\" : \"render\" , \"message\" : \"Hello everyone\"}));\r\n                // ws.send(JSON.stringify({\"action\" : \"useState\" ,\"key\":\"votes\", \"scope\":\"base\"}));\r\n                // console.log (\"sent\")\r\n                // setOpen(true);\r\n                setSecOpen((secOpen) => {\r\n                    const updated = [...secOpen];\r\n                    updated[i] = true;\r\n                    setSecOpen(updated);\r\n                })\r\n            });\r\n            ws.addEventListener('message', async (event) => {\r\n                const data = await consume(event);\r\n            });\r\n            return ws;\r\n        })\r\n    }, [typeof window]);\r\n    useEffect(() => {\r\n        on(socket, 'error', () => {\r\n            const message = logger.error`Connecting to socket ${url}.`\r\n            setError(message);\r\n        })\r\n    }, []);\r\n\r\n\r\n    return <context.Provider value={{ setHeaders, socket, sockets, open, secOpen, allOpen, useAtom, headers, error }}>\r\n        <Web3Provider>\r\n            {props.children}\r\n        </Web3Provider>\r\n    </context.Provider>\r\n}\r\n\r\nexport const Provider = (props) => {\r\n    return <JotaiProvider>\r\n        <_Provider {...props} />\r\n    </JotaiProvider>\r\n\r\n}","import React, { useCallback, useContext, useMemo, useRef } from 'react';\r\nimport baseLogger from './logger';\r\nimport { useComponent } from './hooks';\r\nconst logger = baseLogger.scope('ServerComponent');\r\n\r\nexport const context = React.createContext();\r\nexport const internalContext = React.createContext();\r\n\r\n\r\nexport const useAction = (name, handler, callback) => {\r\n    const ctx = useContext(internalContext);\r\n    window.ctx = ctx;\r\n    const { children = [] } = ctx;\r\n\r\n    const action = children.find((child) => {\r\n        return child.component === 'Action' && child.props.name === name;\r\n    });\r\n\r\n    if (!action)\r\n        return () => { console.warn('Handler not available') }\r\n\r\n    if (action && action?.props?.fns && action?.props?.fns[handler]) {\r\n        return action.props.fns[handler];\r\n    }\r\n\r\n    return action.handler;\r\n}\r\n\r\nexport const useProps = () => {\r\n    return useContext(context);\r\n}\r\n\r\nexport class ErrorBoundary extends React.Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = { hasError: false };\r\n    }\r\n\r\n    static getDerivedStateFromError(error) {\r\n        // Update state so the next render will show the fallback UI.\r\n        return { hasError: true };\r\n    }\r\n\r\n    render() {\r\n        if (this.state.hasError) {\r\n            // You can render any custom fallback UI\r\n            return <h1>Something went wrong.</h1>;\r\n        }\r\n\r\n        return this.props.children;\r\n    }\r\n}\r\n\r\n\r\nexport const ChildComponent = (props) => {\r\n    const ctx = useContext(internalContext);\r\n    const { children = [] } = ctx;\r\n    const { index } = props;\r\n\r\n    const serverChildren = children.filter((child) => {\r\n        return child.component === \"ClientComponent\"\r\n    });\r\n    const serverProps = serverChildren[index];\r\n\r\n    console.log(\"CHILD COMPONENT\", serverChildren, serverProps, children, ctx);\r\n    return props.children;\r\n    const mappedProps = Object.entries(serverProps).reduce((obj, [key, state]) => {\r\n        if (state)\r\n        state[Symbol.for('l0g.format')] = () => state.value;\r\n        if (resolved[state.key]) {\r\n\r\n            // logger.error('HAS RESOLVED', obj, key);\r\n\r\n            return Object.assign(obj, {\r\n                [key]: resolved[state.key]\r\n            })\r\n        }\r\n\r\n        /** Map a live state to a property */\r\n        if (state.id && state.key && state.scope)\r\n            return Object.assign(obj, {\r\n                [key]: state.value\r\n            })\r\n        return Object.assign(obj, { [key]: state });\r\n    }, {})\r\n\r\n    mappedProps.error = error;\r\n\r\n    return <internalContext.Provider value={serverProps}>\r\n        <context.Provider value={mappedProps}>\r\n            {props.children}\r\n        </context.Provider>\r\n    </internalContext.Provider>\r\n}\r\n\r\nexport const useProps2 = () => {\r\n    const { props } = useContext(internalContext);\r\n    return props\r\n}\r\nexport const ServerComponent2Child = (props) => {\r\n    const { name, children, index, ...clientProps} = props;\r\n    const {children: serverChildren} = useContext(internalContext);\r\n\r\n\r\n    return <internalContext.Provider value={{ props: {foo:'bar'} }}>\r\n        {JSON.stringify(serverChildren)}\r\n    </internalContext.Provider>\r\n}\r\nexport const ServerComponent2 = (props) => {\r\n    const { name, children, ...clientProps } = props;\r\n\r\n    const { props: { children: serverChildren, ...serverProps } } = useComponent(name, { props: clientProps });\r\n    const parent = useContext(internalContext);\r\n\r\n    if (parent) {\r\n        return <ServerComponent2Child {...props} />\r\n    }\r\n    return <internalContext.Provider value={{ children: serverChildren, props: serverProps }}>\r\n        {children}\r\n    </internalContext.Provider>\r\n}\r\n\r\n\r\nexport const ServerComponent = (props) => {\r\n    const { name, scope, children, index = 0, ...clientProps } = props;\r\n    const parentCtx = useContext(internalContext);\r\n\r\n    let rendered\r\n    if (parentCtx) {\r\n        const parentChildren = [parentCtx.children].flat(2).filter(c => c.component === 'ClientComponent')\r\n        console.log(\"PARENT CHILDREN\", parentChildren, [parentCtx.children].flat(2));\r\n        const child = parentChildren.find(child => child.key === name) || parentChildren[index];\r\n        rendered = child;\r\n    }\r\n    const component = useComponent(name, { scope, props: clientProps }, rendered);\r\n    const { props: serverProps = {}, resolved, error } = component;\r\n    const { children: serverChildren = [], ...rest } = serverProps;\r\n\r\n    const mappedProps = Object.entries(rest).reduce((obj, [key, state]) => {\r\n        if (state != null && typeof state !== 'string' && typeof state !== 'number') {\r\n            state[Symbol.for('l0g.format')] = () => state.value;\r\n        }\r\n        console.log (\"map props\", key, state, resolved);\r\n        if (resolved[key]) {\r\n            return Object.assign(obj, {\r\n                [key]: resolved[key]\r\n            })\r\n        }\r\n        /** Map a live state to a property */\r\n        if (state.id && state.key && state.scope)\r\n            return Object.assign(obj, {\r\n                [key]: state.value\r\n            })\r\n        return Object.assign(obj, { [key]: state });\r\n    }, {})\r\n\r\n    mappedProps.error = error;\r\n    return <internalContext.Provider value={{ ...serverProps, name }}>\r\n        <context.Provider value={mappedProps}>\r\n            {children}\r\n        </context.Provider>\r\n    </internalContext.Provider>\r\n}\r\nServerComponent.childMap = {};\r\nexport const Slot = () => {\r\n\r\n}\r\n\r\nexport const Action = (props, name) => {\r\n    const { ctx } = useContext(internalContext);\r\n\r\n    return <>\r\n        {props.children}\r\n    </>\r\n}\r\n\r\n","import { useContext, useEffect, useMemo, useState } from \"react\";\r\nimport { web3Context } from \"./Web3\";\r\n\r\nexport const web3Strategy = () => {\r\n  const { account, active, activateInjected, sign, deactivate } = useContext(web3Context);\r\n  const [signature, setSignature] = useState(null);\r\n  const [autoSign, setAutoSign] = useState(false);\r\n\r\n  const connect = async () => {\r\n    await activateInjected();\r\n  }\r\n  \r\n  useEffect(() => {\r\n    (async () => {\r\n      await activateInjected();\r\n    })()\r\n  }, []);\r\n\r\n\r\n  const authenticate = async (challenge) => {\r\n    if (account) {\r\n      const response = await sign(challenge, account);\r\n      return { challenge, response, success: true, strategy: 'web3' }\r\n    } else {\r\n      await activateInjected();\r\n      return { success: false }\r\n\r\n    }\r\n  }\r\n\r\n  return { authenticate, id: account, logout: deactivate}\r\n}"],"names":["SCOPE_CLIENT","EVENT_DELIM","EVENT_SET_STATE","EVENT_USE_STATE","EVENT_CREATE_STATE","EVENT_ERROR","EVENT_USE_COMPONENT","DEFAULT_SCOPE","context","createContext","Logger","l0g","Color","formatters","ChromeTransport","transports","colors","type","string","object","key","level","warning","info","formatter","options","ts","scope","message","formatMap","get","isArray","unshift","v","length","isObject","constructor","name","Object","keys","orgLogger","packageLogger","windowLogger","window","logger","hookLogger","parseSocketResponse","data","body","statusCode","Error","parsed","JSON","parse","e","baseLogger","emit","socket","Array","forEach","send","stringify","request","id","v4","Promise","resolve","reject","onResponse","event","consume","json","off","on","fn","addEventListener","removeEventListener","onMessage","stateCount","increaseCount","join","delim","strings","genEventName","genIdEventName","genSetStateEventName","genCreateStateEventName","genErrorEventName","alignArgs","def","args","nargs","i","alignUseServerStateArgs","atoms","Map","useStream","useContext","open","useMemo","useState","setData","useEffect","action","stateLoadingStates","useServerState","clientDefaultValue","strict","defaultValue","defer","value","suspend","requestType","rest","ctx","payload","debugProps","defaultState","atm","has","atom","clientId","set","removeAllListeners","bind","useAtom","state","setState","setLoading","loading","extendState","error","setStateEvent","createStateEvent","errorEvent","onTimeout","to","onSetValue","eventData","requestId","clearTimeout","onError","err","setServerState","console","log","Function","prototype","useResponse","keepAlive","setId","componentAtoms","loadingStates","useComponent","componentKey","rendered","clientProps","props","logAtom","sockets","secOpen","allOpen","headers","component","internalState","componentState","resolved","propKey","serverProps","resolvedState","setValue","setKey","toUpperCase","slice","children","filter","child","fns","handler","reduce","assign","errObj","cs","setTimeout","tag","raw","setMessageLevel","useServerAtom","setAtomValue","injected","InjectedConnector","supportedChainIds","getLibrary","provider","connector","ETHWeb3Provider","web3Context","Web3UtilProvider","verify","account","web3","sign","sig","recover","acc","toLowerCase","eth","personal","ecRecover","res","Web3","web3React","library","autoActivate","useWeb3React","activate","active","setWeb3","activateInjected","_web3","React","Web3Provider","Web3ReactProvider","map","useLocalStorage","storedValue","localStorage","parsedValue","setPersistentValue","val","useClientContext","internalCtx","web3Ctx","compId","useAuth","useStrategy","auto","authenticate","phase","challenge","auth","success","response","setHeaders","Authorization","setHasAuthed","deauth","logout","authed","address","newHeaders","headerAtom","_Provider","urls","url","staticHeaders","setOpen","setSecOpen","setError","all","cur","WebSocket","ws","updated","Provider","JotaiProvider","internalContext","useAction","callback","find","warn","useProps","ErrorBoundary","hasError","getDerivedStateFromError","render","Component","ChildComponent","index","serverChildren","useProps2","ServerComponent2Child","foo","ServerComponent2","parent","ServerComponent","parentCtx","parentChildren","flat","c","mappedProps","entries","obj","Symbol","childMap","Slot","Action","web3Strategy","deactivate","strategy"],"mappings":"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"}