{"version":3,"file":"index.modern.js","sources":["../node_modules/babel-plugin-transform-async-to-promises/helpers.js","../src/consts.js","../src/context.js","../src/logger.js","../src/debug.js","../src/util.js","../src/hooks.js","../src/Web3.js","../src/hooks/jotai.js","../src/provider.js","../src/ServerComponent.js","../src/strategies.js"],"sourcesContent":["// A type of promise-like that resolves synchronously and supports only one observer\nexport const _Pact = /*#__PURE__*/(function() {\n\tfunction _Pact() {}\n\t_Pact.prototype.then = function(onFulfilled, onRejected) {\n\t\tconst result = new _Pact();\n\t\tconst state = this.s;\n\t\tif (state) {\n\t\t\tconst callback = state & 1 ? onFulfilled : onRejected;\n\t\t\tif (callback) {\n\t\t\t\ttry {\n\t\t\t\t\t_settle(result, 1, callback(this.v));\n\t\t\t\t} catch (e) {\n\t\t\t\t\t_settle(result, 2, e);\n\t\t\t\t}\n\t\t\t\treturn result;\n\t\t\t} else {\n\t\t\t\treturn this;\n\t\t\t}\n\t\t}\n\t\tthis.o = function(_this) {\n\t\t\ttry {\n\t\t\t\tconst value = _this.v;\n\t\t\t\tif (_this.s & 1) {\n\t\t\t\t\t_settle(result, 1, onFulfilled ? onFulfilled(value) : value);\n\t\t\t\t} else if (onRejected) {\n\t\t\t\t\t_settle(result, 1, onRejected(value));\n\t\t\t\t} else {\n\t\t\t\t\t_settle(result, 2, value);\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\t_settle(result, 2, e);\n\t\t\t}\n\t\t};\n\t\treturn result;\n\t}\n\treturn _Pact;\n})();\n\n// Settles a pact synchronously\nexport function _settle(pact, state, value) {\n\tif (!pact.s) {\n\t\tif (value instanceof _Pact) {\n\t\t\tif (value.s) {\n\t\t\t\tif (state & 1) {\n\t\t\t\t\tstate = value.s;\n\t\t\t\t}\n\t\t\t\tvalue = value.v;\n\t\t\t} else {\n\t\t\t\tvalue.o = _settle.bind(null, pact, state);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\tif (value && value.then) {\n\t\t\tvalue.then(_settle.bind(null, pact, state), _settle.bind(null, pact, 2));\n\t\t\treturn;\n\t\t}\n\t\tpact.s = state;\n\t\tpact.v = value;\n\t\tconst observer = pact.o;\n\t\tif (observer) {\n\t\t\tobserver(pact);\n\t\t}\n\t}\n}\n\nexport function _isSettledPact(thenable) {\n\treturn thenable instanceof _Pact && thenable.s & 1;\n}\n\n// Converts argument to a function that always returns a Promise\nexport function _async(f) {\n\treturn function() {\n\t\tfor (var args = [], i = 0; i < arguments.length; i++) {\n\t\t\targs[i] = arguments[i];\n\t\t}\n\t\ttry {\n\t\t\treturn Promise.resolve(f.apply(this, args));\n\t\t} catch(e) {\n\t\t\treturn Promise.reject(e);\n\t\t}\n\t}\n}\n\n// Awaits on a value that may or may not be a Promise (equivalent to the await keyword in ES2015, with continuations passed explicitly)\nexport function _await(value, then, direct) {\n\tif (direct) {\n\t\treturn then ? then(value) : value;\n\t}\n\tif (!value || !value.then) {\n\t\tvalue = Promise.resolve(value);\n\t}\n\treturn then ? value.then(then) : value;\n}\n\n// Awaits on a value that may or may not be a Promise, then ignores it\nexport function _awaitIgnored(value, direct) {\n\tif (!direct) {\n\t\treturn value && value.then ? value.then(_empty) : Promise.resolve();\n\t}\n}\n\n// Proceeds after a value has resolved, or proceeds immediately if the value is not thenable\nexport function _continue(value, then) {\n\treturn value && value.then ? value.then(then) : then(value);\n}\n\n// Proceeds after a value has resolved, or proceeds immediately if the value is not thenable\nexport function _continueIgnored(value) {\n\tif (value && value.then) {\n\t\treturn value.then(_empty);\n\t}\n}\n\n// Asynchronously iterate through an object that has a length property, passing the index as the first argument to the callback (even as the length property changes)\nexport function _forTo(array, body, check) {\n\tvar i = -1, pact, reject;\n\tfunction _cycle(result) {\n\t\ttry {\n\t\t\twhile (++i < array.length && (!check || !check())) {\n\t\t\t\tresult = body(i);\n\t\t\t\tif (result && result.then) {\n\t\t\t\t\tif (_isSettledPact(result)) {\n\t\t\t\t\t\tresult = result.v;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresult.then(_cycle, reject || (reject = _settle.bind(null, pact = new _Pact(), 2)));\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (pact) {\n\t\t\t\t_settle(pact, 1, result);\n\t\t\t} else {\n\t\t\t\tpact = result;\n\t\t\t}\n\t\t} catch (e) {\n\t\t\t_settle(pact || (pact = new _Pact()), 2, e);\n\t\t}\n\t}\n\t_cycle();\n\treturn pact;\n}\n\n// Asynchronously iterate through an object's properties (including properties inherited from the prototype)\n// Uses a snapshot of the object's properties\nexport function _forIn(target, body, check) {\n\tvar keys = [];\n\tfor (var key in target) {\n\t\tkeys.push(key);\n\t}\n\treturn _forTo(keys, function(i) { return body(keys[i]); }, check);\n}\n\n// Asynchronously iterate through an object's own properties (excluding properties inherited from the prototype)\n// Uses a snapshot of the object's properties\nexport function _forOwn(target, body, check) {\n\tvar keys = [];\n\tfor (var key in target) {\n\t\tif (Object.prototype.hasOwnProperty.call(target, key)) {\n\t\t\tkeys.push(key);\n\t\t}\n\t}\n\treturn _forTo(keys, function(i) { return body(keys[i]); }, check);\n}\n\nexport const _iteratorSymbol = /*#__PURE__*/ typeof Symbol !== \"undefined\" ? (Symbol.iterator || (Symbol.iterator = Symbol(\"Symbol.iterator\"))) : \"@@iterator\";\n\n// Asynchronously iterate through an object's values\n// Uses for...of if the runtime supports it, otherwise iterates until length on a copy\nexport function _forOf(target, body, check) {\n\tif (typeof target[_iteratorSymbol] === \"function\") {\n\t\tvar iterator = target[_iteratorSymbol](), step, pact, reject;\n\t\tfunction _cycle(result) {\n\t\t\ttry {\n\t\t\t\twhile (!(step = iterator.next()).done && (!check || !check())) {\n\t\t\t\t\tresult = body(step.value);\n\t\t\t\t\tif (result && result.then) {\n\t\t\t\t\t\tif (_isSettledPact(result)) {\n\t\t\t\t\t\t\tresult = result.v;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tresult.then(_cycle, reject || (reject = _settle.bind(null, pact = new _Pact(), 2)));\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (pact) {\n\t\t\t\t\t_settle(pact, 1, result);\n\t\t\t\t} else {\n\t\t\t\t\tpact = result;\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\t_settle(pact || (pact = new _Pact()), 2, e);\n\t\t\t}\n\t\t}\n\t\t_cycle();\n\t\tif (iterator.return) {\n\t\t\tvar _fixup = function(value) {\n\t\t\t\ttry {\n\t\t\t\t\tif (!step.done) {\n\t\t\t\t\t\titerator.return();\n\t\t\t\t\t}\n\t\t\t\t} catch(e) {\n\t\t\t\t}\n\t\t\t\treturn value;\n\t\t\t}\n\t\t\tif (pact && pact.then) {\n\t\t\t\treturn pact.then(_fixup, function(e) {\n\t\t\t\t\tthrow _fixup(e);\n\t\t\t\t});\n\t\t\t}\n\t\t\t_fixup();\n\t\t}\n\t\treturn pact;\n\t}\n\t// No support for Symbol.iterator\n\tif (!(\"length\" in target)) {\n\t\tthrow new TypeError(\"Object is not iterable\");\n\t}\n\t// Handle live collections properly\n\tvar values = [];\n\tfor (var i = 0; i < target.length; i++) {\n\t\tvalues.push(target[i]);\n\t}\n\treturn _forTo(values, function(i) { return body(values[i]); }, check);\n}\n\nexport const _asyncIteratorSymbol = /*#__PURE__*/ typeof Symbol !== \"undefined\" ? (Symbol.asyncIterator || (Symbol.asyncIterator = Symbol(\"Symbol.asyncIterator\"))) : \"@@asyncIterator\";\n\n// Asynchronously iterate on a value using it's async iterator if present, or its synchronous iterator if missing\nexport function _forAwaitOf(target, body, check) {\n\tif (typeof target[_asyncIteratorSymbol] === \"function\") {\n\t\tvar pact = new _Pact();\n\t\tvar iterator = target[_asyncIteratorSymbol]();\n\t\titerator.next().then(_resumeAfterNext).then(void 0, _reject);\n\t\treturn pact;\n\t\tfunction _resumeAfterBody(result) {\n\t\t\tif (check && check()) {\n\t\t\t\treturn _settle(pact, 1, iterator.return ? iterator.return().then(function() { return result; }) : result);\n\t\t\t}\n\t\t\titerator.next().then(_resumeAfterNext).then(void 0, _reject);\n\t\t}\n\t\tfunction _resumeAfterNext(step) {\n\t\t\tif (step.done) {\n\t\t\t\t_settle(pact, 1);\n\t\t\t} else {\n\t\t\t\tPromise.resolve(body(step.value)).then(_resumeAfterBody).then(void 0, _reject);\n\t\t\t}\n\t\t}\n\t\tfunction _reject(error) {\n\t\t\t_settle(pact, 2, iterator.return ? iterator.return().then(function() { return error; }) : error);\n\t\t}\n\t}\n\treturn Promise.resolve(_forOf(target, function(value) { return Promise.resolve(value).then(body); }, check));\n}\n\n// Asynchronously implement a generic for loop\nexport function _for(test, update, body) {\n\tvar stage;\n\tfor (;;) {\n\t\tvar shouldContinue = test();\n\t\tif (_isSettledPact(shouldContinue)) {\n\t\t\tshouldContinue = shouldContinue.v;\n\t\t}\n\t\tif (!shouldContinue) {\n\t\t\treturn result;\n\t\t}\n\t\tif (shouldContinue.then) {\n\t\t\tstage = 0;\n\t\t\tbreak;\n\t\t}\n\t\tvar result = body();\n\t\tif (result && result.then) {\n\t\t\tif (_isSettledPact(result)) {\n\t\t\t\tresult = result.s;\n\t\t\t} else {\n\t\t\t\tstage = 1;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif (update) {\n\t\t\tvar updateValue = update();\n\t\t\tif (updateValue && updateValue.then && !_isSettledPact(updateValue)) {\n\t\t\t\tstage = 2;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\tvar pact = new _Pact();\n\tvar reject = _settle.bind(null, pact, 2);\n\t(stage === 0 ? shouldContinue.then(_resumeAfterTest) : stage === 1 ? result.then(_resumeAfterBody) : updateValue.then(_resumeAfterUpdate)).then(void 0, reject);\n\treturn pact;\n\tfunction _resumeAfterBody(value) {\n\t\tresult = value;\n\t\tdo {\n\t\t\tif (update) {\n\t\t\t\tupdateValue = update();\n\t\t\t\tif (updateValue && updateValue.then && !_isSettledPact(updateValue)) {\n\t\t\t\t\tupdateValue.then(_resumeAfterUpdate).then(void 0, reject);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t\tshouldContinue = test();\n\t\t\tif (!shouldContinue || (_isSettledPact(shouldContinue) && !shouldContinue.v)) {\n\t\t\t\t_settle(pact, 1, result);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (shouldContinue.then) {\n\t\t\t\tshouldContinue.then(_resumeAfterTest).then(void 0, reject);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tresult = body();\n\t\t\tif (_isSettledPact(result)) {\n\t\t\t\tresult = result.v;\n\t\t\t}\n\t\t} while (!result || !result.then);\n\t\tresult.then(_resumeAfterBody).then(void 0, reject);\n\t}\n\tfunction _resumeAfterTest(shouldContinue) {\n\t\tif (shouldContinue) {\n\t\t\tresult = body();\n\t\t\tif (result && result.then) {\n\t\t\t\tresult.then(_resumeAfterBody).then(void 0, reject);\n\t\t\t} else {\n\t\t\t\t_resumeAfterBody(result);\n\t\t\t}\n\t\t} else {\n\t\t\t_settle(pact, 1, result);\n\t\t}\n\t}\n\tfunction _resumeAfterUpdate() {\n\t\tif (shouldContinue = test()) {\n\t\t\tif (shouldContinue.then) {\n\t\t\t\tshouldContinue.then(_resumeAfterTest).then(void 0, reject);\n\t\t\t} else {\n\t\t\t\t_resumeAfterTest(shouldContinue);\n\t\t\t}\n\t\t} else {\n\t\t\t_settle(pact, 1, result);\n\t\t}\n\t}\n}\n\n// Asynchronously implement a do ... while loop\nexport function _do(body, test) {\n\tvar awaitBody;\n\tdo {\n\t\tvar result = body();\n\t\tif (result && result.then) {\n\t\t\tif (_isSettledPact(result)) {\n\t\t\t\tresult = result.v;\n\t\t\t} else {\n\t\t\t\tawaitBody = true;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tvar shouldContinue = test();\n\t\tif (_isSettledPact(shouldContinue)) {\n\t\t\tshouldContinue = shouldContinue.v;\n\t\t}\n\t\tif (!shouldContinue) {\n\t\t\treturn result;\n\t\t}\n\t} while (!shouldContinue.then);\n\tconst pact = new _Pact();\n\tconst reject = _settle.bind(null, pact, 2);\n\t(awaitBody ? result.then(_resumeAfterBody) : shouldContinue.then(_resumeAfterTest)).then(void 0, reject);\n\treturn pact;\n\tfunction _resumeAfterBody(value) {\n\t\tresult = value;\n\t\tfor (;;) {\n\t\t\tshouldContinue = test();\n\t\t\tif (_isSettledPact(shouldContinue)) {\n\t\t\t\tshouldContinue = shouldContinue.v;\n\t\t\t}\n\t\t\tif (!shouldContinue) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tif (shouldContinue.then) {\n\t\t\t\tshouldContinue.then(_resumeAfterTest).then(void 0, reject);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tresult = body();\n\t\t\tif (result && result.then) {\n\t\t\t\tif (_isSettledPact(result)) {\n\t\t\t\t\tresult = result.v;\n\t\t\t\t} else {\n\t\t\t\t\tresult.then(_resumeAfterBody).then(void 0, reject);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t_settle(pact, 1, result);\n\t}\n\tfunction _resumeAfterTest(shouldContinue) {\n\t\tif (shouldContinue) {\n\t\t\tdo {\n\t\t\t\tresult = body();\n\t\t\t\tif (result && result.then) {\n\t\t\t\t\tif (_isSettledPact(result)) {\n\t\t\t\t\t\tresult = result.v;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresult.then(_resumeAfterBody).then(void 0, reject);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tshouldContinue = test();\n\t\t\t\tif (_isSettledPact(shouldContinue)) {\n\t\t\t\t\tshouldContinue = shouldContinue.v;\n\t\t\t\t}\n\t\t\t\tif (!shouldContinue) {\n\t\t\t\t\t_settle(pact, 1, result);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t} while (!shouldContinue.then);\n\t\t\tshouldContinue.then(_resumeAfterTest).then(void 0, reject);\n\t\t} else {\n\t\t\t_settle(pact, 1, result);\n\t\t}\n\t}\n}\n\n// Asynchronously implement a switch statement\nexport function _switch(discriminant, cases) {\n\tvar dispatchIndex = -1;\n\tvar awaitBody;\n\touter: {\n\t\tfor (var i = 0; i < cases.length; i++) {\n\t\t\tvar test = cases[i][0];\n\t\t\tif (test) {\n\t\t\t\tvar testValue = test();\n\t\t\t\tif (testValue && testValue.then) {\n\t\t\t\t\tbreak outer;\n\t\t\t\t}\n\t\t\t\tif (testValue === discriminant) {\n\t\t\t\t\tdispatchIndex = i;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Found the default case, set it as the pending dispatch case\n\t\t\t\tdispatchIndex = i;\n\t\t\t}\n\t\t}\n\t\tif (dispatchIndex !== -1) {\n\t\t\tdo {\n\t\t\t\tvar body = cases[dispatchIndex][1];\n\t\t\t\twhile (!body) {\n\t\t\t\t\tdispatchIndex++;\n\t\t\t\t\tbody = cases[dispatchIndex][1];\n\t\t\t\t}\n\t\t\t\tvar result = body();\n\t\t\t\tif (result && result.then) {\n\t\t\t\t\tawaitBody = true;\n\t\t\t\t\tbreak outer;\n\t\t\t\t}\n\t\t\t\tvar fallthroughCheck = cases[dispatchIndex][2];\n\t\t\t\tdispatchIndex++;\n\t\t\t} while (fallthroughCheck && !fallthroughCheck());\n\t\t\treturn result;\n\t\t}\n\t}\n\tconst pact = new _Pact();\n\tconst reject = _settle.bind(null, pact, 2);\n\t(awaitBody ? result.then(_resumeAfterBody) : testValue.then(_resumeAfterTest)).then(void 0, reject);\n\treturn pact;\n\tfunction _resumeAfterTest(value) {\n\t\tfor (;;) {\n\t\t\tif (value === discriminant) {\n\t\t\t\tdispatchIndex = i;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tif (++i === cases.length) {\n\t\t\t\tif (dispatchIndex !== -1) {\n\t\t\t\t\tbreak;\n\t\t\t\t} else {\n\t\t\t\t\t_settle(pact, 1, result);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t\ttest = cases[i][0];\n\t\t\tif (test) {\n\t\t\t\tvalue = test();\n\t\t\t\tif (value && value.then) {\n\t\t\t\t\tvalue.then(_resumeAfterTest).then(void 0, reject);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tdispatchIndex = i;\n\t\t\t}\n\t\t}\n\t\tdo {\n\t\t\tvar body = cases[dispatchIndex][1];\n\t\t\twhile (!body) {\n\t\t\t\tdispatchIndex++;\n\t\t\t\tbody = cases[dispatchIndex][1];\n\t\t\t}\n\t\t\tvar result = body();\n\t\t\tif (result && result.then) {\n\t\t\t\tresult.then(_resumeAfterBody).then(void 0, reject);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar fallthroughCheck = cases[dispatchIndex][2];\n\t\t\tdispatchIndex++;\n\t\t} while (fallthroughCheck && !fallthroughCheck());\n\t\t_settle(pact, 1, result);\n\t}\n\tfunction _resumeAfterBody(result) {\n\t\tfor (;;) {\n\t\t\tvar fallthroughCheck = cases[dispatchIndex][2];\n\t\t\tif (!fallthroughCheck || fallthroughCheck()) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tdispatchIndex++;\n\t\t\tvar body = cases[dispatchIndex][1];\n\t\t\twhile (!body) {\n\t\t\t\tdispatchIndex++;\n\t\t\t\tbody = cases[dispatchIndex][1];\n\t\t\t}\n\t\t\tresult = body();\n\t\t\tif (result && result.then) {\n\t\t\t\tresult.then(_resumeAfterBody).then(void 0, reject);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\t_settle(pact, 1, result);\n\t}\n}\n\n// Asynchronously call a function and pass the result to explicitly passed continuations\nexport function _call(body, then, direct) {\n\tif (direct) {\n\t\treturn then ? then(body()) : body();\n\t}\n\ttry {\n\t\tvar result = Promise.resolve(body());\n\t\treturn then ? result.then(then) : result;\n\t} catch (e) {\n\t\treturn Promise.reject(e);\n\t}\n}\n\n// Asynchronously call a function and swallow the result\nexport function _callIgnored(body, direct) {\n\treturn _call(body, _empty, direct);\n}\n\n// Asynchronously call a function and pass the result to explicitly passed continuations\nexport function _invoke(body, then) {\n\tvar result = body();\n\tif (result && result.then) {\n\t\treturn result.then(then);\n\t}\n\treturn then(result);\n}\n\n// Asynchronously call a function and swallow the result\nexport function _invokeIgnored(body) {\n\tvar result = body();\n\tif (result && result.then) {\n\t\treturn result.then(_empty);\n\t}\n}\n\n// Asynchronously call a function and send errors to recovery continuation\nexport function _catch(body, recover) {\n\ttry {\n\t\tvar result = body();\n\t} catch(e) {\n\t\treturn recover(e);\n\t}\n\tif (result && result.then) {\n\t\treturn result.then(void 0, recover);\n\t}\n\treturn result;\n}\n\n// Asynchronously await a promise and pass the result to a finally continuation\nexport function _finallyRethrows(body, finalizer) {\n\ttry {\n\t\tvar result = body();\n\t} catch (e) {\n\t\treturn finalizer(true, e);\n\t}\n\tif (result && result.then) {\n\t\treturn result.then(finalizer.bind(null, false), finalizer.bind(null, true));\n\t}\n\treturn finalizer(false, result);\n}\n\n// Asynchronously await a promise and invoke a finally continuation that always overrides the result\nexport function _finally(body, finalizer) {\n\ttry {\n\t\tvar result = body();\n\t} catch (e) {\n\t\treturn finalizer();\n\t}\n\tif (result && result.then) {\n\t\treturn result.then(finalizer, finalizer);\n\t}\n\treturn finalizer();\n}\n\n// Rethrow or return a value from a finally continuation\nexport function _rethrow(thrown, value) {\n\tif (thrown)\n\t\tthrow value;\n\treturn value;\n}\n\n// Empty function to implement break and other control flow that ignores asynchronous results\nexport function _empty() {\n}\n\n// Sentinel value for early returns in generators \nexport const _earlyReturn = /*#__PURE__*/ {};\n\n// Asynchronously call a function and send errors to recovery continuation, skipping early returns\nexport function _catchInGenerator(body, recover) {\n\treturn _catch(body, function(e) {\n\t\tif (e === _earlyReturn) {\n\t\t\tthrow e;\n\t\t}\n\t\treturn recover(e);\n\t});\n}\n\n// Asynchronous generator class; accepts the entrypoint of the generator, to which it passes itself when the generator should start\nexport const _AsyncGenerator = /*#__PURE__*/(function() {\n\tfunction _AsyncGenerator(entry) {\n\t\tthis._entry = entry;\n\t\tthis._pact = null;\n\t\tthis._resolve = null;\n\t\tthis._return = null;\n\t\tthis._promise = null;\n\t}\n\n\tfunction _wrapReturnedValue(value) {\n\t\treturn { value: value, done: true };\n\t}\n\tfunction _wrapYieldedValue(value) {\n\t\treturn { value: value, done: false };\n\t}\n\n\t_AsyncGenerator.prototype._yield = function(value) {\n\t\t// Yield the value to the pending next call\n\t\tthis._resolve(value && value.then ? value.then(_wrapYieldedValue) : _wrapYieldedValue(value));\n\t\t// Return a pact for an upcoming next/return/throw call\n\t\treturn this._pact = new _Pact();\n\t};\n\t_AsyncGenerator.prototype.next = function(value) {\n\t\t// Advance the generator, starting it if it has yet to be started\n\t\tconst _this = this;\n\t\treturn _this._promise = new Promise(function (resolve) {\n\t\t\tconst _pact = _this._pact;\n\t\t\tif (_pact === null) {\n\t\t\t\tconst _entry = _this._entry;\n\t\t\t\tif (_entry === null) {\n\t\t\t\t\t// Generator is started, but not awaiting a yield expression\n\t\t\t\t\t// Abandon the next call!\n\t\t\t\t\treturn resolve(_this._promise);\n\t\t\t\t}\n\t\t\t\t// Start the generator\n\t\t\t\t_this._entry = null;\n\t\t\t\t_this._resolve = resolve;\n\t\t\t\tfunction returnValue(value) {\n\t\t\t\t\t_this._resolve(value && value.then ? value.then(_wrapReturnedValue) : _wrapReturnedValue(value));\n\t\t\t\t\t_this._pact = null;\n\t\t\t\t\t_this._resolve = null;\n\t\t\t\t}\n\t\t\t\tvar result = _entry(_this);\n\t\t\t\tif (result && result.then) {\n\t\t\t\t\tresult.then(returnValue, function(error) {\n\t\t\t\t\t\tif (error === _earlyReturn) {\n\t\t\t\t\t\t\treturnValue(_this._return);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconst pact = new _Pact();\n\t\t\t\t\t\t\t_this._resolve(pact);\n\t\t\t\t\t\t\t_this._pact = null;\n\t\t\t\t\t\t\t_this._resolve = null;\n\t\t\t\t\t\t\t_resolve(pact, 2, error);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\treturnValue(result);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Generator is started and a yield expression is pending, settle it\n\t\t\t\t_this._pact = null;\n\t\t\t\t_this._resolve = resolve;\n\t\t\t\t_settle(_pact, 1, value);\n\t\t\t}\n\t\t});\n\t};\n\t_AsyncGenerator.prototype.return = function(value) {\n\t\t// Early return from the generator if started, otherwise abandons the generator\n\t\tconst _this = this;\n\t\treturn _this._promise = new Promise(function (resolve) {\n\t\t\tconst _pact = _this._pact;\n\t\t\tif (_pact === null) {\n\t\t\t\tif (_this._entry === null) {\n\t\t\t\t\t// Generator is started, but not awaiting a yield expression\n\t\t\t\t\t// Abandon the return call!\n\t\t\t\t\treturn resolve(_this._promise);\n\t\t\t\t}\n\t\t\t\t// Generator is not started, abandon it and return the specified value\n\t\t\t\t_this._entry = null;\n\t\t\t\treturn resolve(value && value.then ? value.then(_wrapReturnedValue) : _wrapReturnedValue(value));\n\t\t\t}\n\t\t\t// Settle the yield expression with a rejected \"early return\" value\n\t\t\t_this._return = value;\n\t\t\t_this._resolve = resolve;\n\t\t\t_this._pact = null;\n\t\t\t_settle(_pact, 2, _earlyReturn);\n\t\t});\n\t};\n\t_AsyncGenerator.prototype.throw = function(error) {\n\t\t// Inject an exception into the pending yield expression\n\t\tconst _this = this;\n\t\treturn _this._promise = new Promise(function (resolve, reject) {\n\t\t\tconst _pact = _this._pact;\n\t\t\tif (_pact === null) {\n\t\t\t\tif (_this._entry === null) {\n\t\t\t\t\t// Generator is started, but not awaiting a yield expression\n\t\t\t\t\t// Abandon the throw call!\n\t\t\t\t\treturn resolve(_this._promise);\n\t\t\t\t}\n\t\t\t\t// Generator is not started, abandon it and return a rejected Promise containing the error\n\t\t\t\t_this._entry = null;\n\t\t\t\treturn reject(error);\n\t\t\t}\n\t\t\t// Settle the yield expression with the value as a rejection\n\t\t\t_this._resolve = resolve;\n\t\t\t_this._pact = null;\n\t\t\t_settle(_pact, 2, error);\n\t\t});\n\t};\n\n\t_AsyncGenerator.prototype[_asyncIteratorSymbol] = function() {\n\t\treturn this;\n\t};\n\t\n\treturn _AsyncGenerator;\n})();\n","export const SCOPE_CLIENT = '$client';\r\nexport const SCOPE_GLOBAL = 'global';\r\n\r\nexport const EVENT_DELIM = ':';\r\nexport const EVENT_SET_STATE = 'setState';\r\nexport const EVENT_USE_STATE = 'useState';\r\nexport const EVENT_CREATE_STATE = 'createState';\r\nexport const EVENT_ERROR = 'error';\r\n\r\nexport const EVENT_USE_COMPONENT = 'render';\r\nexport const EVENT_EXECUTE_ACTION = 'executeAction';\r\n\r\nexport const DEFAULT_SCOPE = SCOPE_CLIENT;","import { createContext } from \"react\";\r\n\r\nexport const context = createContext();\r\n","import l0g from 'l0g';\r\n\r\n//Screw this. Because of static class properties I'm forced to transpile my code. \r\n//I don't want to change my source code as it reads way cleaner using static properties\r\n//I need to bundle it for the web any way but using react that should happen automatically\r\n\r\nconst {\r\n    Logger,\r\n    formatters: {Color},\r\n    transports: {ChromeTransport}\r\n} = l0g;\r\n\r\n// static colors = {\r\n//     type: {\r\n//       string: 'lime',\r\n//       number: 'yellow',\r\n//       // object: 'white'\r\n//     },\r\n//     key: {\r\n//       scope: 'blue',\r\n//       ts: 'green',\r\n//       level: {\r\n//         info: 'green',\r\n//         warning: 'orange',\r\n//         error: 'red',\r\n//         debug: 'blue',\r\n//       },\r\n//     },\r\n//     highlight: 'lime.black',\r\n//     default: 'white'\r\n//   };\r\n\r\nColor.colors.type.string = 'green';\r\nColor.colors.type.object = 'green';\r\nColor.colors.key.level.warning = 'red';\r\nColor.colors.key.level.info = 'blue';\r\nconst formatter = new Color((options) => {\r\n    const {ts, level, scope, message} = options;\r\n    return `${ts} ${scope} ${level}: ${message}`\r\n});\r\n\r\nColor.formatMap.get(Color.isArray).unshift((v) => v && `Array[${v.length}]`);\r\nColor.formatMap.get(Color.isObject).unshift((v) => v && `${v.constructor.name}[${Object.keys(v)}]`);\r\n\r\nconst transports = [\r\n    new ChromeTransport({formatter}),\r\n];\r\n\r\nexport const orgLogger = new Logger('debug', {transports}).scope('state-less');\r\nexport const packageLogger = orgLogger.scope('react-client');\r\nconst windowLogger = orgLogger.scope('browser-console');\r\n\r\nif (typeof window !== 'undefined') {\r\n\r\n    window.Logger = Logger;\r\n    window.logger = windowLogger;\r\n}\r\n\r\nexport default packageLogger;","import { useEffect, useRef } from \"react\";\r\nimport logger from './logger'\r\n\r\nconst hookLogger = logger.scope('useTraceUpdate');\r\nexport function useTraceUpdate(props, name) {\r\n    const prev = useRef(props);\r\n    useEffect(() => {\r\n      const changedProps = Object.entries(props).reduce((ps, [k, v]) => {\r\n        if (prev.current[k] !== v) {\r\n          ps[k] = [prev.current[k], v];\r\n        }\r\n        return ps;\r\n      }, {});\r\n      if (Object.keys(changedProps).length > 0) {\r\n        hookLogger.debug`Propery ${name} changed. New props are ${JSON.stringify(props)}`\r\n      } else {\r\n        hookLogger.debug`Propery ${name} didn't change. New props are ${props}`\r\n\r\n      }\r\n      prev.current = props;\r\n    });\r\n  }","import { v4 } from 'uuid';\r\nimport baseLogger from './logger';\r\n\r\nexport const parseSocketResponse = (data) => {\r\n    const { body, statusCode, message } = data;\r\n\r\n    if (statusCode !== 200 && statusCode !== 500) {\r\n        throw new Error(message || 'Internal Server Error');\r\n    }\r\n\r\n    try {\r\n        const parsed = JSON.parse(body);\r\n        return parsed;\r\n    } catch (e) {\r\n        const message = baseLogger.warning`Error parsing render result ${e}`;\r\n        throw new Error(message);\r\n    }\r\n}\r\n\r\nexport const emit = (socket, data) => {\r\n    if (Array.isArray(socket)) {\r\n        socket.forEach((socket) => {\r\n            socket.send(JSON.stringify(data));\r\n        })\r\n    } else {\r\n        socket.send(JSON.stringify(data));\r\n    }\r\n}\r\n\r\nexport const request = async (socket, data) => {\r\n    const id = v4();\r\n    emit(socket, {type: request,  ...data, id});\r\n    return new Promise((resolve, reject) => {\r\n\r\n        const onResponse = async (event) => {\r\n            const data = await consume(event);\r\n            const json = parseSocketResponse(data);\r\n            \r\n            if (data.id === id) {\r\n                off(socket, 'message', onResponse)\r\n                resolve(json);\r\n            }\r\n        }\r\n        on(socket, 'message', onResponse);\r\n    })\r\n}\r\n\r\nexport const on = (socket, event, fn) => {\r\n    if (Array.isArray(socket)) {\r\n        socket.forEach((socket) => {\r\n            socket.addEventListener(event, fn);\r\n        })\r\n    } else {\r\n        socket.addEventListener(event, fn)\r\n    }\r\n}\r\n\r\nexport const off = (socket, event, fn) => {\r\n    if (Array.isArray(socket)) {\r\n        socket.forEach((socket) => {\r\n            socket.removeEventListener(event, fn);\r\n        })\r\n    } else {\r\n        socket.removeEventListener(event, fn);\r\n    }\r\n}\r\nexport const onMessage = (socket, fn) => on(socket, 'message', fn);\r\n\r\nexport const consume = async (event) => {\r\n    try {\r\n        return JSON.parse(event.data);\r\n    } catch (e) {\r\n        if (typeof event.data === 'string') \r\n            return event.data;\r\n        throw e;\r\n    }\r\n}","import React, { createContext, useEffect, useState, useContext, useMemo } from 'react';\r\nimport { EVENT_ERROR, EVENT_CREATE_STATE, EVENT_DELIM, EVENT_SET_STATE, EVENT_USE_STATE, DEFAULT_SCOPE, EVENT_EXECUTE_ACTION, EVENT_USE_COMPONENT } from './consts';\r\nimport { context } from './context';\r\nimport { atom, useAtom } from 'jotai';\r\nimport baseLogger, { orgLogger } from './logger';\r\nimport { parse, v4 } from 'uuid';\r\nimport { useTraceUpdate } from './debug';\r\nimport packageLogger from './logger';\r\nimport { on, onMessage, emit, consume, off, parseSocketResponse, request } from './util';\r\n\r\nlet stateCount = 0;\r\n\r\nconst increaseCount = () => stateCount++;\r\nconst join = delim => (...strings) => strings.join(delim);\r\nconst genEventName = join(EVENT_DELIM);\r\nconst genIdEventName = event => id => genEventName(event, id);\r\nconst genSetStateEventName = genIdEventName(EVENT_SET_STATE);\r\nconst genCreateStateEventName = genIdEventName(EVENT_CREATE_STATE);\r\nconst genErrorEventName = genIdEventName(EVENT_ERROR);\r\nconst genComponentEvent = genIdEventName(EVENT_USE_COMPONENT);\r\nconst genActionEvent = genIdEventName(EVENT_EXECUTE_ACTION);\r\n\r\n\r\n\r\n/**\r\n * @typedef {'$client' | \"String\"} StateScope - The scope of the state qwe\r\n */\r\n\r\n/**\r\n * @typedef {Object} UseServerStateOptions\r\n * @property {String} key - The key of the state on the server e.g. 'foo'\r\n * @property {StateScope} scope - The scope of the state on the server e.g. bar\r\n * @property {Boolean} strict - Strict mode.\r\n * @property {Serializable} defaultValue - Initial value the server stores and sends back.\r\n */\r\n\r\n/**\r\n * useServerState - Hook to request a state on a public/private state-server.\r\n * @param {*} clientDefaultValue - Initial value the client stores. e.g. \"Loading...\"\r\n * @param {UseServerStateOptions} options - Options\r\n */\r\n\r\nconst alignArgs = (length, ...def) => (...args) => {\r\n    const nargs = [...args];\r\n    for (var i = length; i > def.length; i--) {\r\n        if (!args[i - 1]) {\r\n            nargs[i - 1] = args[i - 2];\r\n            nargs[i - 2] = def[i - 2];\r\n        }\r\n    }\r\n    return nargs;\r\n}\r\n\r\nconst alignUseServerStateArgs = alignArgs(2, null);\r\n\r\nconst atoms = new Map();\r\n\r\nconst useStore = (store, key) => {\r\n    const [atom, setAtom] = useState(null);\r\n};\r\n\r\nexport const useStream = (name, def) => {\r\n    const {socket, open} = useContext(context);\r\n    const id = useMemo(() => v4());\r\n    const [data, setData] = useState(def || null);\r\n\r\n    useEffect(() => {\r\n        if (open) {\r\n            emit(socket, {action: 'stream', name, id});\r\n            on(socket, 'message', async (event) => {\r\n                const data = await consume(event);\r\n                const json = parseSocketResponse(data);\r\n                if (data.id === id) {\r\n                    setData(json);\r\n                }\r\n            })\r\n        }\r\n    },[open]);\r\n\r\n    return data;\r\n}\r\nexport const useServerState = (clientDefaultValue, options) => {\r\n    var [clientDefaultValue, options] = alignUseServerStateArgs(clientDefaultValue, options);\r\n    const {\r\n        key,\r\n        strict = false,\r\n        defaultValue,\r\n        defer = false,\r\n        value = defaultValue,\r\n        scope = DEFAULT_SCOPE,\r\n        suspend = false,\r\n        rendered = null,\r\n        requestType = 'request',\r\n        ...rest\r\n    } = options\r\n    const ctx = useContext(context);\r\n    try {\r\n        const { socket, open, payload } = ctx;\r\n        const debugProps = useMemo(() => ({ clientDefaultValue, options }))\r\n        const defaultState = useMemo(() => ({ value: clientDefaultValue, id: rest.id || null, scope, key }));\r\n        let atm;\r\n\r\n        if (!atoms.has(`${scope}:${key}`)) {\r\n            atm = atom({ defaultState, clientId: increaseCount() })\r\n            atoms.set(`${scope}:${key}`, atm);\r\n        } else {\r\n            atm = atoms.get(`${scope}:${key}`)\r\n        }\r\n\r\n        const removeAllListeners = useMemo(() => false && socket.removeAllListeners.bind(socket), [socket]);\r\n\r\n        const [state, setState] = useAtom(atm);\r\n\r\n        \r\n        useEffect(() => {\r\n            if (rest.id) {\r\n                setState({...state, id: rest.id})\r\n            }\r\n        }, [rest.id]);\r\n\r\n        const { clientId } = state;\r\n\r\n        const [loading, setLoading] = useState(false);\r\n\r\n        const extendState = data => setState({ ...state, ...data });\r\n\r\n        const { id, error } = state;\r\n        const setStateEvent = useMemo(() => genSetStateEventName(id), [id]);\r\n        const createStateEvent = useMemo(() => genCreateStateEventName(clientId), [clientId]);\r\n        const errorEvent = useMemo(() => genErrorEventName(clientId), [clientId]);\r\n\r\n        const onTimeout = () => {\r\n            setState((state) => {\r\n                const id = state.id;\r\n                if (!id) {\r\n                    return {\r\n                        ...state,\r\n                        error: new Error('Cancelling state due to timeout')\r\n                    }\r\n                }\r\n                return state;\r\n            })\r\n\r\n            setLoading(false);\r\n        }\r\n\r\n        useEffect(() => {\r\n            let to;\r\n            if (open && !id && !error && !loading && !defer) {\r\n                var onSetValue = async (event) => {\r\n                    const eventData = await consume(event);\r\n                    const data = parseSocketResponse(eventData);\r\n                    if (eventData.action === 'setValue' && (clientId === eventData.requestId || id === data.id) && typeof data.value === 'undefined') {\r\n                        return state;\r\n                    }\r\n                    if (eventData.action === 'setValue' && (clientId === eventData.requestId || id === data.id)) {\r\n                        setState((state) => {\r\n                            return { ...state, ...data }\r\n                        });\r\n                    }\r\n                    // setState(() => {\r\n                    //     return data;\r\n                    // });\r\n                };\r\n                onMessage(socket, onSetValue);\r\n                on(socket, 'message',async (event) => {\r\n                    const data = await consume(event);\r\n                    if (data.type === 'error') {\r\n                        const err = await parseSocketResponse(data);\r\n                        extendState({error: new Error(err)});\r\n                    }\r\n                });\r\n                emit(socket, { action: EVENT_USE_STATE, key, value, scope, requestId: clientId, options: { ...rest }, requestType });\r\n                setLoading(to);\r\n            }\r\n\r\n            clearTimeout(loading);\r\n            return () => {\r\n                off(socket, 'message', onSetValue);\r\n                // [createStateEvent].forEach(event => socket.removeAllListeners(event));\r\n            }\r\n        }, [open, defer])\r\n\r\n        useEffect(() => {\r\n            if (id) {\r\n                if (!defer && id) {\r\n                    var onSetValue = async () => {\r\n                        const eventData = await consume(event);\r\n                        const data = parseSocketResponse(eventData);\r\n                        if (eventData.action === 'setValue' && (clientId === eventData.requestId || id === data.id) && typeof data.value !== 'undefined') {\r\n                            return state;\r\n                        }\r\n                        if (eventData.action === 'setValue' && (clientId === eventData.requestId || id === data.id)) {\r\n                            setState((state) => {\r\n                                delete state.error;\r\n                                return { ...state, ...data }\r\n                            });\r\n                        }\r\n                    }\r\n                    on(socket, 'message', onSetValue)\r\n                    on(socket, 'message',async (event) => {\r\n                        const data = await consume(event);\r\n                        if (data.type === 'error') {\r\n                            const err = await parseSocketResponse(data);\r\n                            extendState({error: new Error(err)});\r\n                        }\r\n                    });\r\n                }\r\n            }\r\n            return () => {\r\n                if (id) {\r\n                    off(socket, 'message', onSetValue)\r\n                }\r\n            }\r\n        });\r\n\r\n        useEffect(() => {\r\n            if (strict && error) {\r\n                throw error;\r\n            }\r\n        }, [error]);\r\n\r\n        useEffect(() => {\r\n            // if (id || error) {\r\n            setLoading(false);\r\n            // }\r\n        }, [id, error, key]);\r\n\r\n        const setServerState = (value) => {\r\n            socket.emit(EVENT_SET_STATE, {\r\n                id,\r\n                key,\r\n                value,\r\n            }, {\r\n                scope\r\n            })\r\n        }\r\n\r\n        if (state.error) {\r\n            if (strict) {\r\n                throw new Error(state.error);\r\n            }\r\n            return [state.error, state.value];\r\n        }\r\n\r\n        if (suspend && !state.value && loading && !id) {\r\n            // return [state.value, createStateEvent];\r\n            throw new Promise(Function.prototype)\r\n\r\n        }\r\n\r\n        if (!key && options.defer) {\r\n            return [clientDefaultValue || null];\r\n        }\r\n\r\n        // baseLogger.debug`Returning live state ${state} ${key} with value ${state.value} ${clientDefaultValue}`\r\n        return [state.value || clientDefaultValue, setServerState];\r\n    } catch (e) {\r\n        if (!ctx) throw new Error('No available context. Are you missing a Provider?');\r\n        throw e;\r\n    }\r\n}\r\n\r\n\r\nexport const useResponse = (fn, action, keepAlive) => {\r\n    const ctx = useContext(context);\r\n\r\n    const { socket } = ctx;\r\n\r\n    const [id, setId] = useState(null);\r\n\r\n    useEffect(() => {\r\n        if (!id) return;\r\n        onMessage(socket, async (event) => {\r\n            const eventData = await consume(event);\r\n            const data = parseSocketResponse(eventData);\r\n            if (eventData.id === id) {\r\n                fn(data);\r\n            }\r\n        })\r\n    }, [id]);\r\n\r\n    return (...args) => {\r\n        const id = action(...args);\r\n        setId(id);\r\n    };\r\n}\r\nconst componentAtoms = new Map();\r\n\r\n\r\n\r\n/**\r\n * useComponent - Hook that renders serverside components\r\n * @param {*} componentKey - The key of the serverside component \r\n * @param {*} options - Options\r\n * @param {boolean} options.strict - Throws errors in strict mode \r\n * @param {boolean} options.suspend - Throws a promise while loading\r\n * @param {string} options.scope - The scope of the components store\r\n */\r\nexport const useComponent = (componentKey, options = {}, rendered) => {\r\n    const {\r\n        strict = false,\r\n        suspend = true,\r\n        scope = DEFAULT_SCOPE,\r\n        props: clientProps,\r\n        ...rest\r\n    } = options\r\n\r\n    const ctx = useContext(context);\r\n    const logAtom = useMemo(() => atom(), [componentKey]);\r\n    try {\r\n        const { socket, sockets, open, secOpen, allOpen, headers } = ctx;\r\n        const debugProps = useMemo(() => ({ key: componentKey, options }))\r\n        const defaultState = useMemo(() => ({ component: rendered, props: {}, scope, key: componentKey }));\r\n\r\n        let atm;\r\n\r\n        if (!componentAtoms.has(`${scope}:${componentKey}`)) {\r\n            atm = atom({ defaultState })\r\n            componentAtoms.set(`${scope}:${componentKey}`, atm);\r\n        } else {\r\n            atm = componentAtoms.get(`${scope}:${componentKey}`)\r\n        }\r\n\r\n        const removeAllListeners = useMemo(() => false && socket.removeAllListeners.bind(socket), [socket]);\r\n\r\n        const [internalState, setState] = useAtom(atm);\r\n        const [loading, setLoading] = useState(false);\r\n        const extendState = data => setState({ ...state, ...data });\r\n\r\n        const {\r\n            component,\r\n\r\n        } = internalState;\r\n\r\n        const [componentState] = useServerState(component, {\r\n            key: componentKey,\r\n            scope: 'public',\r\n            defer: !component && !rendered,\r\n            requestType: 'subscribe',\r\n            rendered,\r\n        });\r\n        // useTraceUpdate(internalState);\r\n\r\n        const resolved = {};\r\n        const keys = Object.keys((componentState || rendered)?.props || {});\r\n        keys.length = 15;\r\n\r\n\r\n        for (const propKey of keys) {\r\n            const serverProps = (componentState||rendered)?.props || {};\r\n            const state = serverProps[propKey] || {};\r\n\r\n            const resolvedState = useServerState(state.value, {\r\n                key: state.key,\r\n                scope: state.scope,\r\n                id: state.id,\r\n                defer: !state.id || !state.key || !state.scope\r\n            });\r\n            if (state.id && state.key && state.scope) {\r\n                if (typeof resolvedState[0] !== 'undefined') {\r\n                    const [value, setValue] = resolvedState;\r\n                    const setKey = `set${propKey[0].toUpperCase()}${propKey.slice(1)}`\r\n                    resolved[propKey] = value;\r\n                    resolved[setKey] = setValue;\r\n                }\r\n            }\r\n        }\r\n        /**Bind action functions */\r\n        (componentState||rendered)?.props?.children?.filter((child) => {\r\n            return child.component === 'Action';\r\n        }).forEach((action) => {\r\n            action.props.fns = action.props.handler.reduce((fns, handler) => {\r\n                return Object.assign(fns, {\r\n                    [handler]: async (...args) => {\r\n                        const id = v4();\r\n                        return request([socket, ...sockets], { action: 'call', id, componentKey, name: action.props.name, handler, args, headers });\r\n                        \r\n                    }\r\n                });\r\n            }, {});\r\n\r\n        })\r\n\r\n        const { props, error } = component || {};\r\n        const cs = useMemo(() => ({rendered}))\r\n\r\n        const onTimeout = () => {\r\n            setLoading(false);\r\n        }\r\n\r\n        useEffect(() => {\r\n            let to;\r\n            if (open && !props && !error && !loading) {\r\n                to = setTimeout(onTimeout, 15000)\r\n                onMessage(socket, async (event) => {\r\n                    try {\r\n\r\n                        const eventData = await consume(event);\r\n                        /**TODO: fix base scope === 'public' */\r\n                        if (eventData.action === 'render' && eventData.key == componentKey) {\r\n                            const data = parseSocketResponse(eventData);\r\n                            const {error, ...rest} = internalState;\r\n                            setState({ ...rest, component: data });\r\n                        }\r\n                    } catch (e) {\r\n                    }\r\n                });\r\n\r\n                onMessage(socket, async (event) => {\r\n                    const data = await consume(event);\r\n                    if (data.type === 'error') {\r\n                        const err = await parseSocketResponse(data);\r\n                        const errObj = new Error(err.message);\r\n                        Object.assign(errObj, err);\r\n                        console.log(\"Parsed Error\", err);\r\n                        extendState({error: errObj});\r\n                    }\r\n                });\r\n\r\n                on(socket, 'log', (data) => {\r\n                    data.tag[0].raw = 'Fake Tagged Template String Arg';\r\n                    orgLogger.scope(data.scope).setMessageLevel(data.level).log(...data.tag)\r\n                });\r\n\r\n                emit(socket, { action: EVENT_USE_COMPONENT, key: componentKey, scope: scope || 'base', props: clientProps, options: { ...rest }, headers});\r\n\r\n                setLoading(to);\r\n            }\r\n\r\n            secOpen.forEach((open, i) => {\r\n                if (open) {\r\n                    const socket = sockets[i];\r\n                    emit(socket, { action: EVENT_USE_COMPONENT, key: componentKey, scope: scope || 'base', options: { ...rest } });\r\n                }\r\n            })\r\n\r\n            clearTimeout(loading);\r\n\r\n            () => {\r\n                [EVENT_ERROR].forEach(event => socket.removeAllListeners(event));\r\n            }\r\n        }, [open])\r\n\r\n        useEffect(() => {\r\n            if (strict && error) {\r\n                throw new Error(error);\r\n            }\r\n        }, [error]);\r\n\r\n        useEffect(() => {\r\n            setLoading(false);\r\n        }, [internalState.props, error]);\r\n\r\n        if (internalState.error && !component) {\r\n            return internalState\r\n        }\r\n\r\n        if (componentState instanceof Error) {\r\n            throw componentState;\r\n        }\r\n        if (!component && loading) {\r\n            return defaultState;\r\n            throw new Promise(Function.prototype)\r\n        }\r\n\r\n        return { ...(rendered || {}), ...componentState,...internalState, resolved };\r\n    } catch (e) {\r\n        if (!ctx) throw new Error('No available context. Are you missing a Provider?');\r\n        throw e;\r\n    }\r\n}\r\n\r\n\r\nexport const useServerAtom = (atm, clientDefaultValue, options) => {\r\n    const { useAtom } = useContext(context);\r\n\r\n    const [state, setState] = useServerState(clientDefaultValue, options);\r\n    const [value, setAtomValue] = useAtom(atm);\r\n\r\n    useEffect(() => {\r\n        setAtomValue(state);\r\n    }, [state]);\r\n\r\n    return [value, setAtomValue];\r\n}\r\n\r\nconst Test = () => {\r\n    useServerState('test', {\r\n        strict\r\n    })\r\n}\r\n\r\n","import React from 'react';\r\nimport { Web3ReactProvider } from '@web3-react/core';\r\nimport { Web3Provider as ETHWeb3Provider } from \"@ethersproject/providers\";\r\nimport { createContext, useEffect, useState } from 'react';\r\nimport { InjectedConnector } from '@web3-react/injected-connector'\r\nimport { useWeb3React } from '@web3-react/core'\r\nimport Web3 from 'web3'\r\n\r\nexport const injected = new InjectedConnector({ supportedChainIds: [56, 1337] })\r\n\r\nfunction getLibrary(provider, connector) {\r\n  return new ETHWeb3Provider(provider) // this will vary according to whether you use e.g. ethers or web3.js\r\n}\r\n\r\nexport const web3Context = createContext();\r\n\r\nexport const Web3UtilProvider = ({children, autoActivate = true}) => {\r\n  const web3React = useWeb3React();\r\n  const { activate, account, active, error, ...rest } = web3React;\r\n  const [web3, setWeb3] = useState(null);\r\n\r\n\r\n  const activateInjected = async () => activate(injected)\r\n\r\n  useEffect(() => {\r\n    if (!autoActivate) return;\r\n    (async () => {\r\n      await activate(injected);\r\n    })()\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (account) {\r\n      const _web3 = new Web3(web3React?.library?.provider)\r\n      setWeb3(_web3);\r\n    }\r\n  }, [account])\r\n  /**\r\n   * \r\n   * @param {*} web3 - The web3 instance\r\n   * @param {*} message - The message to sign\r\n   * @param {*} account - The account to sign with\r\n   * @returns - The signature\r\n   */\r\n  async function sign (message, account) {\r\n    if (!web3 && !account) throw new Error('Web 3 not yet loaded, please connect an account')\r\n    let res;\r\n    if (account) {\r\n      const web3 = new Web3(web3React?.library?.provider)\r\n      res = await web3.eth.personal.sign(message, account);\r\n    } else {\r\n      res = await web3.eth.personal.sign(message, account);\r\n    }\r\n    return res;\r\n  }\r\n\r\n  /**\r\n   * Recovers the account from a signed message\r\n   * @param {*} web3 \r\n   * @param {*} message \r\n   * @param {*} sig \r\n   */\r\n  async function recover (message, sig) {\r\n    if (!web3) throw new Error('Web 3 not yet loaded, please connect an account')\r\n    const res = await web3.eth.personal.ecRecover(message, sig);\r\n    return res;\r\n  }\r\n\r\n  /**\r\n   * Verifies an account by signing a message.\r\n   * @param *{} web3 \r\n   * @param {*} account  The account to verify\r\n   * @param {*} message  - Optional message to sign.\r\n   * @returns \r\n   */\r\n  async function verify (account, message = 'Please verify your Identity by signing this message.') {\r\n    console.log (\"VERIFY \", account, message)\r\n    if (!web3) throw new Error('Web 3 not yet loaded, please connect an account')\r\n    const sig = await sign(message, account);\r\n    const acc = await recover(message, sig);\r\n    console.log (\"VERIFIED\", account, acc, sig)\r\n    return acc.toLowerCase() === account.toLowerCase();\r\n  }\r\n\r\n  return <web3Context.Provider value={{activateInjected, sign, recover, verify, active, account, error, ...rest}}>\r\n    {children}\r\n  </web3Context.Provider>\r\n}\r\nexport const Web3Provider = ({children, ...rest}) => {\r\n  return <Web3ReactProvider getLibrary={getLibrary}>\r\n    <Web3UtilProvider {...rest}>\r\n      {children}\r\n    </Web3UtilProvider>\r\n  </Web3ReactProvider>\r\n}","import { useAtom } from \"jotai\";\nimport { useEffect } from \"react\";\n\nconst map = {};\n\nexport const useLocalStorage = (name, atom, defaultValue) => {\n  const [value, setValue] = useAtom(atom);\n  useEffect(() => {\n    const storedValue = localStorage[name];\n\n    try {\n      let parsedValue;\n      try {\n        parsedValue = storedValue ? JSON.parse(storedValue) : defaultValue;\n      } catch (e) {\n        parsedValue = null;\n      }\n      if (!map[name]) {\n        map[name] = true;\n        // parsedValue.__initialized = true;\n        setValue(parsedValue);\n      }\n    } catch (e) {\n      throw new Error(e);\n    }\n\n    return () => {\n      map[name] = false;\n    };\n  }, []);\n\n  const setPersistentValue = (val) => {\n    const string = JSON.stringify(val);\n    localStorage[name] = string;\n    setValue(val);\n  };\n\n  return [value, setPersistentValue, setValue];\n};\n","import React, { useContext, useEffect, useMemo, useState } from 'react';\r\nimport { context } from './context';\r\n// import ws from 'ws';\r\nimport { on, emit, consume, request } from './util';\r\n\r\nimport { atom, Provider as JotaiProvider } from 'jotai';\r\nimport { packageLogger } from './logger';\r\nimport { Web3Provider, web3Context } from './Web3';\r\nimport { useLocalStorage } from './hooks/jotai';\r\n// import { web3Context, Web3UtilProvider } from '../../algo-trade-frontend/src/provider/Web3';\r\n\r\nexport const useClientContext = () => {\r\n    const internalCtx = useContext(context);\r\n    const web3Ctx = useContext(web3Context);\r\n    return { ...internalCtx, ...web3Ctx }\r\n}\r\n\r\nlet compId;\r\nexport const useAuth = (useStrategy, auto) => {\r\n    const { open, socket, headers, setHeaders } = useContext(context);\r\n    const { authenticate: auth, logout: deauth, id } = useStrategy();\r\n    const [authed, setHasAuthed] = useState(false);\r\n    useEffect(() => {\r\n        (async () => {\r\n            if (open && !authed) {\r\n                const challenge = await request(socket, { action: 'auth', phase: 'challenge', headers});\r\n                if (challenge.address) {\r\n                    setHasAuthed(true);\r\n                } else {\r\n                    const newHeaders = {...headers};\r\n                    delete newHeaders.Authorization;\r\n                    \r\n                    debugger;\r\n                    setHeaders(newHeaders);\r\n                }\r\n                console.log (\"AUTO LOGIN\", challenge);\r\n            }\r\n        })()\r\n    }, [open, authed]);\r\n\r\n    async function authenticate() {\r\n        const challenge = await request(socket, { action: 'auth', phase: 'challenge' });\r\n        const data = await auth(challenge);\r\n        if (data.success)\r\n            try {\r\n                const response = await request(socket, {\r\n                    action: 'auth',\r\n                    phase: 'response',\r\n                    ...data\r\n                });\r\n                console.log(\"AUTH RESPONSE\", response)\r\n                setHeaders({\r\n                    ...headers,\r\n                    Authorization: `Bearer ${response}`\r\n                });\r\n                setHasAuthed(true);\r\n                return response;\r\n            } catch (e) {\r\n                throw e;\r\n            }\r\n    }\r\n\r\n    function logout() {\r\n        const { Authorization, ...rest } = headers;\r\n        debugger;\r\n        deauth();\r\n        setHeaders(rest);\r\n    }\r\n\r\n    useEffect(() => {\r\n        (async () => {\r\n            if (id && compId && (compId !== id) && authed) {\r\n                compId = id;\r\n                await logout();\r\n            }\r\n        })()\r\n        // return () => {\r\n        //     compId = null;\r\n        // }\r\n    }, [id])\r\n\r\n    return { authenticate, logout };\r\n}\r\n\r\nconst headerAtom = atom();\r\nconst _Provider = (props) => {\r\n    const { urls = [], url, headers: staticHeaders = {}, useAtom } = props;\r\n    const [open, setOpen] = useState(false);\r\n    const [headers, setHeaders] = useLocalStorage('headers', headerAtom, staticHeaders)\r\n    const [secOpen, setSecOpen] = useState(urls.map(() => false));\r\n    const [error, setError] = useState(null);\r\n\r\n    const allOpen = secOpen.reduce((all, cur) => all && cur, open);\r\n    if (!url)\r\n        throw new Error(\"Missing property 'url' in Provider props.\");\r\n\r\n    // const socket = useMemo(() => {\r\n    //     return io(url);³\r\n    // }, [url]);\r\n\r\n    const socket = useMemo(() => {\r\n        if (typeof window === 'undefined' || typeof WebSocket === 'undefined') return;\r\n\r\n\r\n        const ws = new WebSocket(url);\r\n        ws.addEventListener('open', function open() {\r\n            console.log(\"connected\")\r\n            // ws.send(JSON.stringify({\"action\" : \"render\" , \"message\" : \"Hello everyone\"}));\r\n            // ws.send(JSON.stringify({\"action\" : \"useState\" ,\"key\":\"votes\", \"scope\":\"base\"}));\r\n            // console.log (\"sent\")\r\n            setOpen(true);\r\n        });\r\n        ws.addEventListener('message', async (event) => {\r\n            const data = await consume(event);\r\n        });\r\n\r\n        return ws;\r\n    }, [url, typeof window]);\r\n\r\n    const sockets = useMemo(() => {\r\n        return urls.map((url, i) => {\r\n            if (typeof window === 'undefined' || typeof WebSocket === 'undefined') return;\r\n            const ws = new WebSocket(url);\r\n            ws.addEventListener('open', function open() {\r\n                console.log(\"connected\")\r\n                // ws.send(JSON.stringify({\"action\" : \"render\" , \"message\" : \"Hello everyone\"}));\r\n                // ws.send(JSON.stringify({\"action\" : \"useState\" ,\"key\":\"votes\", \"scope\":\"base\"}));\r\n                // console.log (\"sent\")\r\n                // setOpen(true);\r\n                setSecOpen((secOpen) => {\r\n                    const updated = [...secOpen];\r\n                    updated[i] = true;\r\n                    setSecOpen(updated);\r\n                })\r\n            });\r\n            ws.addEventListener('message', async (event) => {\r\n                const data = await consume(event);\r\n            });\r\n            return ws;\r\n        })\r\n    }, [typeof window]);\r\n    useEffect(() => {\r\n        on(socket, 'error', () => {\r\n            const message = logger.error`Connecting to socket ${url}.`\r\n            setError(message);\r\n        })\r\n    }, []);\r\n\r\n\r\n    return <context.Provider value={{ setHeaders, socket, sockets, open, secOpen, allOpen, useAtom, headers, error }}>\r\n        <Web3Provider>\r\n            {props.children}\r\n        </Web3Provider>\r\n    </context.Provider>\r\n}\r\n\r\nexport const Provider = (props) => {\r\n    return <JotaiProvider>\r\n        <_Provider {...props} />\r\n    </JotaiProvider>\r\n\r\n}","import React, { useCallback, useContext, useMemo, useRef } from 'react';\r\nimport baseLogger from './logger';\r\nimport { useComponent } from './hooks';\r\nconst logger = baseLogger.scope('ServerComponent');\r\n\r\nexport const context = React.createContext();\r\nexport const internalContext = React.createContext();\r\n\r\n\r\nexport const useAction = (name, handler, callback) => {\r\n    const ctx = useContext(internalContext);\r\n    window.ctx = ctx;\r\n    const { children = [] } = ctx;\r\n\r\n    const action = children.find((child) => {\r\n        return child.component === 'Action' && child.props.name === name;\r\n    });\r\n\r\n    if (!action)\r\n        return () => { console.warn('Handler not available') }\r\n\r\n    if (action && action?.props?.fns && action?.props?.fns[handler]) {\r\n        return action.props.fns[handler];\r\n    }\r\n\r\n    return action.handler;\r\n}\r\n\r\nexport const useProps = () => {\r\n    return useContext(context);\r\n}\r\n\r\nexport class ErrorBoundary extends React.Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = { hasError: false };\r\n    }\r\n\r\n    static getDerivedStateFromError(error) {\r\n        // Update state so the next render will show the fallback UI.\r\n        return { hasError: true };\r\n    }\r\n\r\n    render() {\r\n        if (this.state.hasError) {\r\n            // You can render any custom fallback UI\r\n            return <h1>Something went wrong.</h1>;\r\n        }\r\n\r\n        return this.props.children;\r\n    }\r\n}\r\n\r\n\r\nexport const ChildComponent = (props) => {\r\n    const ctx = useContext(internalContext);\r\n    const { children = [] } = ctx;\r\n    const { index } = props;\r\n\r\n    const serverChildren = children.filter((child) => {\r\n        return child.component === \"ClientComponent\"\r\n    });\r\n    const serverProps = serverChildren[index];\r\n\r\n    console.log(\"CHILD COMPONENT\", serverChildren, serverProps, children, ctx);\r\n    return props.children;\r\n    const mappedProps = Object.entries(serverProps).reduce((obj, [key, state]) => {\r\n        if (state)\r\n        state[Symbol.for('l0g.format')] = () => state.value;\r\n        if (resolved[state.key]) {\r\n\r\n            // logger.error('HAS RESOLVED', obj, key);\r\n\r\n            return Object.assign(obj, {\r\n                [key]: resolved[state.key]\r\n            })\r\n        }\r\n\r\n        /** Map a live state to a property */\r\n        if (state.id && state.key && state.scope)\r\n            return Object.assign(obj, {\r\n                [key]: state.value\r\n            })\r\n        return Object.assign(obj, { [key]: state });\r\n    }, {})\r\n\r\n    mappedProps.error = error;\r\n\r\n    return <internalContext.Provider value={serverProps}>\r\n        <context.Provider value={mappedProps}>\r\n            {props.children}\r\n        </context.Provider>\r\n    </internalContext.Provider>\r\n}\r\n\r\nexport const useProps2 = () => {\r\n    const { props } = useContext(internalContext);\r\n    return props\r\n}\r\nexport const ServerComponent2Child = (props) => {\r\n    const { name, children, index, ...clientProps} = props;\r\n    const {children: serverChildren} = useContext(internalContext);\r\n\r\n\r\n    return <internalContext.Provider value={{ props: {foo:'bar'} }}>\r\n        {JSON.stringify(serverChildren)}\r\n    </internalContext.Provider>\r\n}\r\nexport const ServerComponent2 = (props) => {\r\n    const { name, children, ...clientProps } = props;\r\n\r\n    const { props: { children: serverChildren, ...serverProps } } = useComponent(name, { props: clientProps });\r\n    const parent = useContext(internalContext);\r\n\r\n    if (parent) {\r\n        return <ServerComponent2Child {...props} />\r\n    }\r\n    return <internalContext.Provider value={{ children: serverChildren, props: serverProps }}>\r\n        {children}\r\n    </internalContext.Provider>\r\n}\r\n\r\n\r\nexport const ServerComponent = (props) => {\r\n    const { name, scope, children, index = 0, ...clientProps } = props;\r\n    const parentCtx = useContext(internalContext);\r\n\r\n    let rendered\r\n    if (parentCtx) {\r\n        const parentChildren = [parentCtx.children].flat(2).filter(c => c.component === 'ClientComponent')\r\n        console.log(\"PARENT CHILDREN\", parentChildren, [parentCtx.children].flat(2));\r\n        const child = parentChildren.find(child => child.key === name) || parentChildren[index];\r\n        rendered = child;\r\n    }\r\n    const component = useComponent(name, { scope, props: clientProps }, rendered);\r\n    const { props: serverProps = {}, resolved, error } = component;\r\n    const { children: serverChildren = [], ...rest } = serverProps;\r\n\r\n    const mappedProps = Object.entries(rest).reduce((obj, [key, state]) => {\r\n        if (state != null && typeof state !== 'string') {\r\n            state[Symbol.for('l0g.format')] = () => state.value;\r\n        }\r\n        if (resolved[key]) {\r\n            return Object.assign(obj, {\r\n                [key]: resolved[key]\r\n            })\r\n        }\r\n        /** Map a live state to a property */\r\n        if (state.id && state.key && state.scope)\r\n            return Object.assign(obj, {\r\n                [key]: state.value\r\n            })\r\n        return Object.assign(obj, { [key]: state });\r\n    }, {})\r\n\r\n    mappedProps.error = error;\r\n    return <internalContext.Provider value={{ ...serverProps, name }}>\r\n        <context.Provider value={mappedProps}>\r\n            {children}\r\n        </context.Provider>\r\n    </internalContext.Provider>\r\n}\r\nServerComponent.childMap = {};\r\nexport const Slot = () => {\r\n\r\n}\r\n\r\nexport const Action = (props, name) => {\r\n    const { ctx } = useContext(internalContext);\r\n\r\n    return <>\r\n        {props.children}\r\n    </>\r\n}\r\n\r\n","import { useContext, useEffect, useMemo, useState } from \"react\";\r\nimport { web3Context } from \"./Web3\";\r\n\r\nexport const web3Strategy = () => {\r\n  const { account, active, activateInjected, sign, deactivate } = useContext(web3Context);\r\n  const [signature, setSignature] = useState(null);\r\n  const [autoSign, setAutoSign] = useState(false);\r\n\r\n  const connect = async () => {\r\n    await activateInjected();\r\n  }\r\n  \r\n  useEffect(() => {\r\n    (async () => {\r\n      await activateInjected();\r\n    })()\r\n  }, []);\r\n\r\n\r\n  const authenticate = async (challenge) => {\r\n    if (account) {\r\n      const response = await sign(challenge, account);\r\n      return { challenge, response, success: true }\r\n    } else {\r\n      await activateInjected();\r\n      return { success: false }\r\n\r\n    }\r\n  }\r\n\r\n  return { authenticate, id: account, logout: deactivate}\r\n}"],"names":["SCOPE_CLIENT","EVENT_DELIM","EVENT_SET_STATE","EVENT_USE_STATE","EVENT_CREATE_STATE","EVENT_ERROR","EVENT_USE_COMPONENT","DEFAULT_SCOPE","context","createContext","Logger","l0g","Color","formatters","ChromeTransport","transports","colors","type","string","object","key","level","warning","info","formatter","options","ts","scope","message","formatMap","get","isArray","unshift","v","length","isObject","constructor","name","Object","keys","orgLogger","packageLogger","windowLogger","window","logger","hookLogger","parseSocketResponse","data","body","statusCode","Error","parsed","JSON","parse","e","baseLogger","emit","socket","Array","forEach","send","stringify","request","id","v4","Promise","resolve","reject","onResponse","event","consume","json","off","on","fn","addEventListener","removeEventListener","onMessage","stateCount","increaseCount","join","delim","strings","genEventName","genIdEventName","genSetStateEventName","genCreateStateEventName","genErrorEventName","alignArgs","def","args","nargs","i","alignUseServerStateArgs","atoms","Map","useStream","useContext","open","useMemo","useState","setData","useEffect","action","useServerState","clientDefaultValue","strict","defaultValue","defer","value","suspend","requestType","rest","ctx","payload","debugProps","defaultState","atm","has","atom","clientId","set","removeAllListeners","bind","useAtom","state","setState","loading","setLoading","extendState","error","setStateEvent","createStateEvent","errorEvent","onTimeout","to","onSetValue","eventData","requestId","err","clearTimeout","setServerState","Function","prototype","useResponse","keepAlive","setId","componentAtoms","useComponent","componentKey","rendered","clientProps","props","logAtom","sockets","secOpen","allOpen","headers","component","internalState","componentState","resolved","propKey","serverProps","resolvedState","setValue","setKey","toUpperCase","slice","children","filter","child","fns","handler","reduce","assign","cs","setTimeout","errObj","console","log","tag","raw","setMessageLevel","useServerAtom","setAtomValue","injected","InjectedConnector","supportedChainIds","getLibrary","provider","connector","ETHWeb3Provider","web3Context","Web3UtilProvider","verify","account","web3","sign","sig","recover","acc","toLowerCase","eth","personal","ecRecover","res","Web3","web3React","library","autoActivate","useWeb3React","activate","active","setWeb3","activateInjected","_web3","Web3Provider","map","useLocalStorage","storedValue","localStorage","parsedValue","setPersistentValue","val","useClientContext","internalCtx","web3Ctx","compId","useAuth","useStrategy","auto","authenticate","phase","challenge","auth","success","response","setHeaders","Authorization","setHasAuthed","deauth","logout","authed","address","newHeaders","headerAtom","_Provider","urls","url","staticHeaders","setOpen","setSecOpen","setError","all","cur","WebSocket","ws","updated","Provider","JotaiProvider","React","internalContext","useAction","callback","find","warn","useProps","ErrorBoundary","hasError","getDerivedStateFromError","render","Component","ChildComponent","index","serverChildren","useProps2","ServerComponent2Child","foo","ServerComponent2","parent","ServerComponent","parentCtx","parentChildren","flat","c","mappedProps","entries","obj","Symbol","childMap","Slot","Action","web3Strategy","deactivate"],"mappings":"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"}